<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>如何使用Performance-Timing进行性能统计？ | Code Me</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="几个名词window.performance.navigation这个属性存储了2个标记redirectCount （页面跳转的次数）和type（页面访问途径类型），其中type有以下几种取值
1234TYPE_BACK_FORWARD: 2TYPE_NAVIGATE: 0TYPE_RELOAD: 1TYPE_RESERVED: 255
window.performance.timing包含了页面">
<meta property="og:type" content="article">
<meta property="og:title" content="如何使用Performance-Timing进行性能统计？">
<meta property="og:url" content="http://zhangmhao.github.io/2014/03/06/Performance-Timing/index.html">
<meta property="og:site_name" content="Code Me">
<meta property="og:description" content="几个名词window.performance.navigation这个属性存储了2个标记redirectCount （页面跳转的次数）和type（页面访问途径类型），其中type有以下几种取值
1234TYPE_BACK_FORWARD: 2TYPE_NAVIGATE: 0TYPE_RELOAD: 1TYPE_RESERVED: 255
window.performance.timing包含了页面">
<meta property="og:updated_time" content="2015-09-22T13:47:38.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="如何使用Performance-Timing进行性能统计？">
<meta name="twitter:description" content="几个名词window.performance.navigation这个属性存储了2个标记redirectCount （页面跳转的次数）和type（页面访问途径类型），其中type有以下几种取值
1234TYPE_BACK_FORWARD: 2TYPE_NAVIGATE: 0TYPE_RELOAD: 1TYPE_RESERVED: 255
window.performance.timing包含了页面">
  
    <link rel="alternative" href="/atom.xml" title="Code Me" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://www.gravatar.com/avatar/fb8601449879167556af06aa6a895cd4?s=300" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Andrew Zhang</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="/github.com/zhangmhao" title="github">github</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/Com/" style="font-size: 10px;">Com</a> <a href="/tags/api/" style="font-size: 10px;">api</a> <a href="/tags/cookie/" style="font-size: 10px;">cookie</a> <a href="/tags/css/" style="font-size: 10px;">css</a> <a href="/tags/haskell/" style="font-size: 10px;">haskell</a> <a href="/tags/html5/" style="font-size: 10px;">html5</a> <a href="/tags/http协议/" style="font-size: 10px;">http协议</a> <a href="/tags/javascript/" style="font-size: 20px;">javascript</a> <a href="/tags/node/" style="font-size: 10px;">node</a> <a href="/tags/nwjs/" style="font-size: 10px;">nwjs</a> <a href="/tags/react/" style="font-size: 10px;">react</a> <a href="/tags/restful/" style="font-size: 10px;">restful</a> <a href="/tags/vim/" style="font-size: 10px;">vim</a> <a href="/tags/交互设计/" style="font-size: 10px;">交互设计</a> <a href="/tags/前端开发/" style="font-size: 10px;">前端开发</a> <a href="/tags/前端性能优化/" style="font-size: 17.5px;">前端性能优化</a> <a href="/tags/回调/" style="font-size: 10px;">回调</a> <a href="/tags/复杂系统/" style="font-size: 10px;">复杂系统</a> <a href="/tags/工具开发/" style="font-size: 10px;">工具开发</a> <a href="/tags/心理学/" style="font-size: 10px;">心理学</a> <a href="/tags/性能优化/" style="font-size: 12.5px;">性能优化</a> <a href="/tags/总结/" style="font-size: 12.5px;">总结</a> <a href="/tags/时间管理/" style="font-size: 12.5px;">时间管理</a> <a href="/tags/构建工具/" style="font-size: 10px;">构建工具</a> <a href="/tags/模块化/" style="font-size: 10px;">模块化</a> <a href="/tags/生活优化/" style="font-size: 10px;">生活优化</a> <a href="/tags/组件化/" style="font-size: 10px;">组件化</a> <a href="/tags/编程语言/" style="font-size: 15px;">编程语言</a> <a href="/tags/设计/" style="font-size: 10px;">设计</a> <a href="/tags/设计文档/" style="font-size: 12.5px;">设计文档</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">探索这个太有趣的世界</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Andrew Zhang</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://www.gravatar.com/avatar/fb8601449879167556af06aa6a895cd4?s=300" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">Andrew Zhang</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="/github.com/zhangmhao" title="github">github</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-Performance-Timing" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/03/06/Performance-Timing/" class="article-date">
  	<time datetime="2014-03-05T16:00:00.000Z" itemprop="datePublished">2014-03-06</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      如何使用Performance-Timing进行性能统计？
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端性能优化/">前端性能优化</a></li></ul>
	</div>

        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/前端开发/">前端开发</a>
	</div>


        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="几个名词">几个名词</h3><h4 id="window-performance-navigation">window.performance.navigation</h4><p>这个属性存储了2个标记<code>redirectCount</code> （页面跳转的次数）和<code>type</code>（页面访问途径类型），其中<code>type</code>有以下几种取值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">TYPE_BACK_FORWARD: <span class="number">2</span></span><br><span class="line">TYPE_NAVIGATE: <span class="number">0</span></span><br><span class="line">TYPE_RELOAD: <span class="number">1</span></span><br><span class="line">TYPE_RESERVED: <span class="number">255</span></span><br></pre></td></tr></table></figure>
<h4 id="window-performance-timing">window.performance.timing</h4><p>包含了页面请求经历的各个时间点，<a href="https://developer.mozilla.org/en-US/docs/Web/API/PerformanceTiming" target="_blank" rel="external">查看MDN上面的文档</a> 例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">fetchstart: 浏览器准备发起HTTP请求去拉取文档，这个时刻之后浏览器会去检查是否有缓存</span><br><span class="line">domainLookupStart: DNS Lookup开始，如果用的是持久连接或者访问本地缓存，该时间点等同于fectchStart</span><br><span class="line">domainLookupEnd: DNS Lookup结束</span><br><span class="line">connectStart: 发起TCP链接，如果使用持久连接，该时间点等同于fetchstart</span><br><span class="line">connectEnd: TCP连接结束，如果使用持久连接，该时间点等同于fetchstart</span><br><span class="line">requestStart: 发起请求向服务器获取文档</span><br><span class="line">responseStart: Time to first Byte</span><br><span class="line">responseEnd: 接收完Response或者连接断开</span><br><span class="line">domLoading: 浏览器解析器开始工作Document.readyState 变为loading</span><br><span class="line">domInteractive: 解析完主文档Document.readyState 变为interactive</span><br><span class="line">domContentLoadeded:</span><br><span class="line">domComplete: 浏览器解析完主文档 Document.readyState变为 complete</span><br><span class="line">loadEventStart: 浏览器触发load事件</span><br><span class="line">loadEventEnd: load事件的处理函数执行结束</span><br></pre></td></tr></table></figure>
<h3 id="用法举例">用法举例</h3><h4 id="DNS_Lookup时间">DNS Lookup时间</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dns = perfData.domainLookupEnd - perfData.domainLookupStart;</span><br></pre></td></tr></table></figure>
<h4 id="Tcp">Tcp</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tcp = perfData.connectEnd - perfData.connectStart</span><br></pre></td></tr></table></figure>
<h4 id="页面加载总时间">页面加载总时间</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> perfData = <span class="built_in">window</span>.performance.timing;</span><br><span class="line"><span class="keyword">var</span> pageLoadTime = perfData.loadEventEnd - perfData.navigationStart;</span><br></pre></td></tr></table></figure>
<h4 id="数据传输时间">数据传输时间</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//仅仅是数据下载的时间</span></span><br><span class="line"><span class="variable"><span class="keyword">var</span> requestTime</span> = perfData.responseEnd - perfData.requestStart;</span><br></pre></td></tr></table></figure>
<h4 id="网络传输时间：包括Redirect，DNS_Lookup，建立连接">网络传输时间：包括Redirect，DNS Lookup，建立连接</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">var</span> requestTime = perfData<span class="class">.responseStart</span> - perfData.navigationStart</span><br></pre></td></tr></table></figure>
<h4 id="首字节时间_Time_To_First_Byte">首字节时间 Time To First Byte</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable"><span class="keyword">var</span> ttfb</span> = perfData.responseStart - perfData.navigationStart;</span><br></pre></td></tr></table></figure>
<h4 id="可交互时间TTI">可交互时间TTI</h4><p>TTI(Time To Interact)指的是页面可交互的时间。页面中的交互包括很多方面，例如点击一个链接、点击一个搜索按钮都属于页面交互的范畴，但是对于衡量性能的TTI则主要指核心功能可以交互的时间。核心功能的定义则是随着页面的不同而不同，例如对于百度首页而言，最为关键的就是搜索框出现的时间、而对于一些购物网站的商品详情页最关键的是购买功能可用和描述出现的时间。而目前的实际情况，TTI大都等于DOM Ready时间，因为不论交互功能是否重要，相关的Javascript都会在DOM Ready后才进行初始化和绑定，而实际上TTI是可以更早的。</p>
<p>如果界面交互不依赖于javascript,例如纯html页面，可交互时间等于</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable"><span class="keyword">var</span> tti</span> = perfData.domInteractive - perfData.navigationStart;</span><br></pre></td></tr></table></figure>
<p>如果界面交互依赖于javascript，可交互时间则没有一个很好的基准，因为不同的应用对可交互的定义并不一样</p>
<p>如果要求不严格，近似的估计可以是</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable"><span class="keyword">var</span> tti</span> = perfData.domComplete - perfData.navigationStart;</span><br><span class="line">或者</span><br><span class="line"><span class="variable"><span class="keyword">var</span> tti</span> = perfData.domContentLoaded - perfData.navigationStart;</span><br></pre></td></tr></table></figure>
<p>更细节的可以是根据业务的场景来判断用户界面什么时候可以交互; 例如一个富文本编辑器的可交互时间，取决于主js文件什么时候完成编辑器的初始化；</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable"><span class="keyword">var</span> tti</span> = 编辑器完成初始化的时间点 - perfData.navigationStart;</span><br></pre></td></tr></table></figure>
<h4 id="页面完全加载">页面完全加载</h4><p>为什么用 loadEventEnd这个时间点表示页面加载完成呢？</p>
<blockquote>
<p>The DOMContentLoaded event is fired when all of the page’s DOM content has been loaded and parsed. The load event is fired once all of the document’s resources (images and CSS files, and so forth) have been fully loaded.</p>
</blockquote>
<p><code>DOMContentLoaded</code>代表的是DOM解析完成并加载，而 <code>load</code> 事件 是页面引用的所有资源文件都加载完成. 所以 load 一般是最后才触发的.</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">perfData</span><span class="class">.loadEventEnd</span> <span class="tag">-</span> <span class="tag">perfData</span><span class="class">.navigationStart</span>;</span><br></pre></td></tr></table></figure>
<h3 id="如何测试Ajax请求的时间呢？">如何测试Ajax请求的时间呢？</h3><p>由于<code>performerce.timing</code>不能用于ajax请求，而是通过<code>mark</code> 和 <code>measure</code>的方式来求得的，用到了两个接口</p>
<ul>
<li><code>performance.mark</code></li>
<li><code>performance.measure</code></li>
<li><code>performance.getEntriesByType</code></li>
</ul>
<p>如下例所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//标记请求的开始</span></span><br><span class="line"><span class="built_in">window</span>.performance.mark(<span class="string">'mark_start_xhr'</span>);</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">    url: <span class="keyword">this</span>.url.newReport,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span>(<span class="params">resp</span>) </span>&#123;</span><br><span class="line">        <span class="comment">//标记请求结束</span></span><br><span class="line">        <span class="built_in">window</span>.performance.mark(<span class="string">'mark_end_xhr'</span>);</span><br><span class="line">        <span class="comment">//求值</span></span><br><span class="line">        <span class="built_in">window</span>.performance.measure(<span class="string">'measure_xhr'</span>, <span class="string">'mark_start_xhr'</span>, <span class="string">'mark_end_xhr'</span>);</span><br><span class="line">        <span class="keyword">var</span> items = <span class="built_in">window</span>.performance.getEntriesByType(<span class="string">'measure'</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(items);</span><br><span class="line">        doSomething(resp)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="参考：">参考：</h3><ol>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/PerformanceTiming" target="_blank" rel="external">Performace timing Api</a></li>
<li><a href="http://www.html5rocks.com/en/tutorials/webperformance/basics/" target="_blank" rel="external">Measuring Page Load Speed​​​​ with Navigation Timing</a></li>
<li><a href="http://www.w3.org/TR/navigation-timing/" target="_blank" rel="external">w3c navigation timing</a></li>
<li><a href="http://www.w3.org/TR/html5/syntax.html#the-end" target="_blank" rel="external">DOMContentLoaded Event From W3c</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/Reference/Events/DOMContentLoaded" target="_blank" rel="external">DomContentLoaded EventFrom MDN</a></li>
<li><a href="http://www.html5rocks.com/en/tutorials/webperformance/usertiming/" target="_blank" rel="external">http://www.html5rocks.com/en/tutorials/webperformance/usertiming/</a></li>
</ol>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/03/07/组件化与复杂系统/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          组件化与复杂系统
        
      </div>
    </a>
  
  
    <a href="/2014/02/12/有關響應時間的問題/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">响应时间应该多长才算快？</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到：</span>
		<a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
		<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>





</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2015 Andrew Zhang
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>