<!doctype html>
<html class="theme-next use-motion ">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />








  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>




<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.5.1"/>




  <meta name="keywords" content="javascript,编程语言," />





  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.1" />


<meta name="description" content="「You don’t konw js」对于有一定编程经验，对javascript有足够开发经验的人来讲，这本书简直就是福音，javascript很有“群众基础 ”，但同时也是被误解最多的语言之一。对于我个人而言，在读这本书的过程中，才发现自己对javascript也有许多误解的地方，收益匪浅。另外，这本书在Github上的关注度非常高, 作者Kyle Simpson能将复杂的概念，用一种非常舒服的">
<meta property="og:type" content="article">
<meta property="og:title" content="You Don't Know JS - this and Object Prototypes 读书笔记">
<meta property="og:url" content="http://zhangmhao.github.io/2015/03/10/You-don't-know-js--this-&-Object-Prototypes-读书笔记/index.html">
<meta property="og:site_name" content="Code Me">
<meta property="og:description" content="「You don’t konw js」对于有一定编程经验，对javascript有足够开发经验的人来讲，这本书简直就是福音，javascript很有“群众基础 ”，但同时也是被误解最多的语言之一。对于我个人而言，在读这本书的过程中，才发现自己对javascript也有许多误解的地方，收益匪浅。另外，这本书在Github上的关注度非常高, 作者Kyle Simpson能将复杂的概念，用一种非常舒服的">
<meta property="og:updated_time" content="2015-09-22T14:20:09.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="You Don't Know JS - this and Object Prototypes 读书笔记">
<meta name="twitter:description" content="「You don’t konw js」对于有一定编程经验，对javascript有足够开发经验的人来讲，这本书简直就是福音，javascript很有“群众基础 ”，但同时也是被误解最多的语言之一。对于我个人而言，在读这本书的过程中，才发现自己对javascript也有许多误解的地方，收益匪浅。另外，这本书在Github上的关注度非常高, 作者Kyle Simpson能将复杂的概念，用一种非常舒服的">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'post'
  };
</script>

  <title> You Don't Know JS - this and Object Prototypes 读书笔记 | Code Me </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  



  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand" rel="start">
      <span class="logo">
        <i class="icon-next-logo"></i>
      </span>
      <span class="site-title">Code Me</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon icon-next-home"></i> <br />
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            <i class="menu-item-icon icon-next-archives"></i> <br />
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            <i class="menu-item-icon icon-next-tags"></i> <br />
            标签
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content"> 

  <div id="posts" class="posts-expand">
    

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              You Don't Know JS - this and Object Prototypes 读书笔记
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-03-10T00:00:00+08:00" content="2015-03-10">
            2015-03-10
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/读书笔记/" itemprop="url" rel="index">
                  <span itemprop="name">读书笔记</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        <span itemprop="articleBody"><p>「<a href="https://github.com/getify/You-Dont-Know-JS" target="_blank" rel="external">You don’t konw js</a>」对于有一定编程经验，对javascript有足够开发经验的人来讲，这本书简直就是福音，javascript很有“群众基础 ”，但同时也是被误解最多的语言之一。对于我个人而言，在读这本书的过程中，才发现自己对javascript也有许多误解的地方，收益匪浅。另外，这本书在Github上的关注度非常高, 作者<a href="http://getify.me/" target="_blank" rel="external">Kyle Simpson</a>能将复杂的概念，用一种非常舒服的逻辑给你娓娓道来。</p>
<p>这一篇的笔记是记下阅读这个系列其中一半 <a href="https://github.com/getify/You-Dont-Know-JS/blob/master/this%20&amp;%20object%20prototypes/README.md#you-dont-know-js-this--object-prototypes" target="_blank" rel="external">You Don’t Know JS: this &amp; Object Prototypes</a>，因为我只记下一些重要的点，所以，只是一篇读书摘录，不适合他人阅读。</p>
<h2 id="this_&amp;_Object_Prototypes">this &amp; Object Prototypes</h2><h3 id="this">this</h3><h4 id="4条规则">4条规则</h4><h5 id="1-_Default_Binding">1. Default Binding</h5><h5 id="2-_Implicit_Binding">2. Implicit Binding</h5><ul>
<li>Implicitly Lost<h5 id="3-_Explicit_Binding">3. Explicit Binding</h5></li>
<li>Hard Binding</li>
<li>API Call “Contexts”<h5 id="4-_new_Binding">4. new Binding</h5></li>
</ul>
<h4 id="4条规则的优先级">4条规则的优先级</h4><p><code>new  Binding</code> &gt; <code>explicit binding</code> &gt; <code>implicit binding</code> &gt; <code>default binding</code></p>
<h4 id="需要注意的点">需要注意的点</h4><h5 id="使用更加安全的this">使用更加安全的this</h5><p>在不需要上下文的情况下，使用null作为 apply, call, bind 的上下文环境参数是一个常见的做法, 例如可以用来传播参数</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> <span class="params">(a, b)</span> </span>&#123; <span class="keyword">return</span> a + b;&#125;</span><br><span class="line">foo.apply(<span class="literal">null</span>, [<span class="number">1</span>, <span class="number">2</span>]); <span class="comment">//spread parameters</span></span><br></pre></td></tr></table></figure>
<p>但是这个做法并不安全，当为 null 的时候，this指向的是global(浏览器下是window); 更安全的做法是使用 <code>Object.create( null );</code> 创建一个空值;</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var ø =<span class="function"> Object.create(</span> null <span class="function">)</span>;// our DMZ empty object</span><br><span class="line">// spreading out<span class="instruction"> array </span>as parameters</span><br><span class="line">foo.apply( ø, <span class="keyword">[</span>2, 3] <span class="function">)</span>; // a:2, b:3</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Object">Object</h3><h4 id="javascript中的6种基本类型（Primary_Type）">javascript中的6种基本类型（Primary Type）</h4><ul>
<li>string</li>
<li>number</li>
<li>boolean</li>
<li>null</li>
<li>undefined</li>
<li>object</li>
</ul>
<blockquote>
<p>It’s a common mis-statement that “everything in JavaScript is an object”. This is clearly not true.</p>
</blockquote>
<p>函数 <code>function</code> 就是<code>object</code>的子类型，严格的叫法是<code>callable object</code>, 数组也是object的一种形式，只是多了一些其他的行为。</p>
<h4 id="内置对象（Built-in_Objects）">内置对象（Built-in Objects）</h4><ul>
<li><code>String</code></li>
<li><code>Number</code></li>
<li><code>Boolean</code></li>
<li><code>Object</code></li>
<li><code>Function</code></li>
<li><code>Array</code></li>
<li><code>Date</code></li>
<li><code>RegExp</code></li>
<li><code>Error</code></li>
</ul>
<h4 id="一些Object的细节点">一些Object的细节点</h4><h5 id="in_和_hasOwnProperty的区别">in 和 hasOwnProperty的区别</h5><p>in 会遍历原型链，而hasOwnProperty只限于object自身</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var myObject = &#123;</span><br><span class="line">    <span class="symbol">a:</span> <span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">(<span class="string">"a"</span> <span class="keyword">in</span> myObject);              <span class="regexp">//</span> <span class="keyword">true</span></span><br><span class="line">(<span class="string">"b"</span> <span class="keyword">in</span> myObject);              <span class="regexp">//</span> <span class="keyword">false</span></span><br><span class="line"></span><br><span class="line">myObject.hasOwnProperty( <span class="string">"a"</span> ); <span class="regexp">//</span> <span class="keyword">true</span></span><br><span class="line">myObject.hasOwnProperty( <span class="string">"b"</span> ); <span class="regexp">//</span> <span class="keyword">false</span></span><br></pre></td></tr></table></figure>
<h5 id="可以枚举（Enumeration），不代表不能访问">可以枚举（Enumeration），不代表不能访问</h5><p>在js的定义中，「enumerable」 表示 </p>
<blockquote>
<p>will be included if the object’s properties are iterated through</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myObject = &#123; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(</span><br><span class="line">    myObject,</span><br><span class="line">    <span class="string">"a"</span>,</span><br><span class="line">    <span class="comment">// make `a` enumerable, as normal</span></span><br><span class="line">    &#123; enumerable: <span class="literal">true</span>, value: <span class="number">2</span> &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(</span><br><span class="line">    myObject,</span><br><span class="line">    <span class="string">"b"</span>,</span><br><span class="line">    <span class="comment">// make `b` NON-enumerable</span></span><br><span class="line">    &#123; enumerable: <span class="literal">false</span>, value: <span class="number">3</span> &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">myObject.b; <span class="comment">// 3</span></span><br><span class="line">(<span class="string">"b"</span> <span class="keyword">in</span> myObject); <span class="comment">// true</span></span><br><span class="line">myObject.hasOwnProperty( <span class="string">"b"</span> ); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// .......</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> k <span class="keyword">in</span> myObject) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log( k, myObject[k] );</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// "a" 2</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.keys( myObject ); <span class="comment">// ["a"]</span></span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertyNames( myObject ); <span class="comment">// ["a", "b"]</span></span><br></pre></td></tr></table></figure>
<p>需要注意的是 <code>Object.keys(..)</code> 返回的是由当前对象可枚举的属性组成的数组; 而<code>Object.getOwnPropertyNames(..)</code>返回的是所有当前对象的属性，这里强调「当前对象」是因为 这两个函数不会遍历原型链的</p>
<hr>
<h3 id="Mixing_(Up)_“Class”_Objects">Mixing (Up) “Class” Objects</h3><p>这一章所讲的内容与之前理解的出入不大，所以不做过多的摘录，记下一些有启发的观点</p>
<p><strong> oo其实只是一种代码组织形式，并非唯一的选择</strong></p>
<blockquote>
<p> if you have experience with “functional programming” (Monads, etc.), you know very well that classes are just one of several common design patterns. But for others, this may be the first time you’ve asked yourself if classes really are a fundamental foundation for code, or if they are an optional abstraction on top of code.<br>Some languages (like Java) don’t give you the choice, so it’s not very optional at all – everything’s a class. Other languages like C/C++ or PHP give you a both procedural and class-oriented syntaxes, and it’s left more to the developer’s choice which style or mixture of styles is appropriate.</p>
</blockquote>
<p>在ES6之后， javascript增加了<code>class</code>的定义，但是否意味着javascript有了类呢？最简单的回答： No!</p>
<p>可以总结一句来说：就是在js中去模仿类继承的机制，也许可以解决问题，但经常也给后面埋下地雷。因为你在javascript假装出来的类机制和其他语言中的类机制是不一样的。</p>
<blockquote>
<p>JavaScript’s object mechanism does not automatically perform copy behavior when you “inherit” or “instantiate”. Plainly, there’s no “classes” in JavaScript to instantiate, only objects. And objects don’t get copied to other objects, they get linked together</p>
</blockquote>
<hr>
<h3 id="Prototype">Prototype</h3><p>Objects in JavaScript have an internal property, denoted in the specification as [[Prototype]], which is simply a reference to another object. </p>
<p>If you use the in operator to test for the existence of a property on an object, in will check the entire chain of the object (regardless of enumerability).</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> anotherObject = &#123;</span><br><span class="line">    a: <span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// create an object linked to `anotherObject`</span></span><br><span class="line"><span class="keyword">var</span> myObject = <span class="built_in">Object</span>.create( anotherObject );</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> k <span class="keyword">in</span> myObject) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"found: "</span> + k);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// found: a</span></span><br><span class="line"></span><br><span class="line">(<span class="string">"a"</span> <span class="keyword">in</span> myObject); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h4 id="需要注意的地方">需要注意的地方</h4><h5 id="引用">引用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> anotherObject = &#123;</span><br><span class="line">    b: [<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> myObject = <span class="built_in">Object</span>.create( anotherObject );</span><br><span class="line"></span><br><span class="line">anotherObject.hasOwnProperty( <span class="string">"b"</span> ); <span class="comment">// true</span></span><br><span class="line">myObject.hasOwnProperty( <span class="string">"b"</span> ); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">myObject.b.push(<span class="number">3</span>);</span><br><span class="line">anotherObject.b; <span class="comment">// [1,2,3]</span></span><br><span class="line">myObject.b; <span class="comment">// [1,2,3]</span></span><br><span class="line"></span><br><span class="line">myObject.hasOwnProperty( <span class="string">"b"</span> ); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>修改<code>myObject.b</code> , 由于my object没有这个值，会继续查找其原型，所以其实是在修改 <code>anotherObject.b</code></p>
<h5 id="Shadowing">Shadowing</h5><p>下面例子与上面的区别就是a是一个number，像这种基础类型(Number,String)的值会发生什么情况呢？</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable"><span class="keyword">var</span> anotherObject</span> = &#123;</span><br><span class="line">    a: <span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable"><span class="keyword">var</span> myObject</span> = Object.create( anotherObject );</span><br><span class="line"></span><br><span class="line">anotherObject.a; <span class="comment">// 2</span></span><br><span class="line">myObject.a; <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">anotherObject.hasOwnProperty( <span class="string">"a"</span> ); <span class="comment">// true</span></span><br><span class="line">myObject.hasOwnProperty( <span class="string">"a"</span> ); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">myObject.a++; <span class="comment">// oops, implicit shadowing!</span></span><br><span class="line"></span><br><span class="line">anotherObject.a; <span class="comment">// 2</span></span><br><span class="line">myObject.a; <span class="comment">// 3</span></span><br><span class="line">myObject.hasOwnProperty( <span class="string">"a"</span> ); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p><code>myObject.a++</code>执行的过程：先从原型取出值，加完之后赋值给 <code>myObject.a</code></p>
<p>那么如果是对于设置了read_only的属性呢？</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> anotherObject = <span class="built_in">Object</span>.create(<span class="built_in">Object</span>.prototype, &#123;</span><br><span class="line">    a: &#123;</span><br><span class="line">        writable: <span class="keyword">false</span>,</span><br><span class="line">        value: <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> myObject = <span class="built_in">Object</span>.create(anotherObject);</span><br><span class="line"></span><br><span class="line">anotherObject.hasOwnProperty( <span class="string">"a"</span> ); <span class="comment">// true</span></span><br><span class="line">myObject.hasOwnProperty( <span class="string">"a"</span> ); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">myObject.a++;</span><br><span class="line"></span><br><span class="line">anotherObject.a; <span class="comment">// 2</span></span><br><span class="line">myObject.a; <span class="comment">// 2</span></span><br><span class="line">myObject.hasOwnProperty( <span class="string">"a"</span> ); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>如果是在<code>use strict</code>严格模式下，这段代码是会报错的,错误信息是:</p>
<p><code>Uncaught TypeError: Cannot assign to read only property &#39;a&#39; of #&lt;Object&gt;</code></p>
<h4 id="Object-prototype">Object.prototype</h4><p>But where exactly does the [[Prototype]] chain “end”?<br>原形链的终点是 <code>Object.prototype</code>  因为在javascript中，所有的对象都是继承自<code>Object.prototype</code></p>
<h4 id="设置Object的值">设置Object的值</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> anotherObject = &#123;</span><br><span class="line">    a: <span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> myObject = <span class="built_in">Object</span>.create( anotherObject );</span><br><span class="line"></span><br><span class="line">anotherObject.a; <span class="comment">// 2</span></span><br><span class="line">myObject.a; <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">anotherObject.hasOwnProperty( <span class="string">"a"</span> ); <span class="comment">// true</span></span><br><span class="line">myObject.hasOwnProperty( <span class="string">"a"</span> ); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">myObject.a++; <span class="comment">// oops, implicit shadowing!</span></span><br><span class="line"></span><br><span class="line">anotherObject.a; <span class="comment">// 2</span></span><br><span class="line">myObject.a; <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">myObject.hasOwnProperty( <span class="string">"a"</span> ); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Be very careful when dealing with delegated properties that you modify. If you wanted to increment anotherObject.a, the only proper way is anotherObject.a++.</span></span><br></pre></td></tr></table></figure>
<h4 id="容易混乱的地方">容易混乱的地方</h4><h5 id="prototype"><code>prototype</code></h5><p><code>[[prototype]]</code>和 <code>prototype</code>的区别</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>) </span>&#123; <span class="comment">/* */</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Foo的[[prototype]]是 Function.prototype</span></span><br><span class="line">Foo.__proto__ === <span class="built_in">Function</span>.prototype; <span class="comment">//true</span></span><br><span class="line"><span class="comment">//也可以通过Object.getPrototypeOf来获取[[prototype]]</span></span><br><span class="line"><span class="built_in">Object</span>.getPrototypeOf(Foo) === <span class="built_in">Function</span>.prototype; <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Foo();</span><br><span class="line"><span class="comment">//a的[[prototype]]是 Foo.prototype</span></span><br><span class="line">a.__proto__ === Foo.prototype;<span class="comment">// true</span></span><br><span class="line"><span class="comment">//或者</span></span><br><span class="line"><span class="built_in">Object</span>.getPrototypeOf(a) === Foo.prototype; <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<h5 id="Functions_不是「构造函数」">Functions 不是「构造函数」</h5><blockquote>
<p>Functions aren’t constructors, but function calls are “constructor calls” if and only if new is used.</p>
<p>This is just unfortunate confusion. In actuality, the .constructor reference is also delegated up to Foo.prototype, which happens to, by default, have a .constructor that points at Foo.</p>
</blockquote>
<p>Foo.prototype.constructor  === Foo 只有通过定义function的时候才会自动创建这个关系，如果改变了Foo.prototype,  创建出来的对象的constructor就不是Foo了，这个很好的表明了Foo不是构造函数的这个概念；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>) </span>&#123; <span class="comment">/* .. */</span> &#125;</span><br><span class="line"></span><br><span class="line">Foo.prototype = &#123; <span class="comment">/* .. */</span> &#125;; <span class="comment">// create a new prototype object</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a1 = <span class="keyword">new</span> Foo();</span><br><span class="line">a1.constructor === Foo; <span class="comment">// false!</span></span><br><span class="line">a1.constructor === <span class="built_in">Object</span>; <span class="comment">// true!</span></span><br></pre></td></tr></table></figure>
<p>为什么 <code>a1.constructor</code> 会变成 <code>Object</code> 呢？ 我直接摘录下书中的介绍</p>
<blockquote>
<p>What’s happening? a1 has no .constructor property, so it delegates up the [[Prototype]] chain to Foo.prototype. But that object doesn’t have a .constructor either (like the default Foo.prototype object would have had!), so it keeps delegating, this time up to Object.prototype, the top of the delegation chain. That object indeed has a .constructor on it, which points to the built-in Object(..) function.</p>
</blockquote>
<p>如果要还原constructor的默认行为，需要许多人工操作</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>) </span>&#123; <span class="comment">/* .. */</span> &#125;</span><br><span class="line"></span><br><span class="line">Foo.prototype = &#123; <span class="comment">/* .. */</span> &#125;; <span class="comment">// create a new prototype object</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Need to properly "fix" the missing `.constructor`</span></span><br><span class="line"><span class="comment">// property on the new object serving as `Foo.prototype`.</span></span><br><span class="line"><span class="comment">// See Chapter 3 for `defineProperty(..)`.</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty( Foo.prototype, <span class="string">"constructor"</span> , &#123;</span><br><span class="line">    enumerable: <span class="literal">false</span>,</span><br><span class="line">    writable: <span class="literal">true</span>,</span><br><span class="line">    configurable: <span class="literal">true</span>,</span><br><span class="line">    value: Foo    <span class="comment">// point `.constructor` at `Foo`</span></span><br><span class="line">&#125; );</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong> <code>a1.constructor</code> is extremely unreliable, and an unsafe reference to rely upon in your code. Generally, such references should be avoided where possible.</strong></p>
</blockquote>
<h4 id="模拟继承">模拟继承</h4><p>在js中，class 的继承一般是这样子实现的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Foo.prototype.myName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Bar</span>(<span class="params">name,label</span>) </span>&#123;</span><br><span class="line">    Foo.call( <span class="keyword">this</span>, name );</span><br><span class="line">    <span class="keyword">this</span>.label = label;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// here, we make a new `Bar.prototype`</span></span><br><span class="line"><span class="comment">// linked to `Foo.prototype`</span></span><br><span class="line">Bar.prototype = <span class="built_in">Object</span>.create( Foo.prototype );</span><br><span class="line"></span><br><span class="line"><span class="comment">// Beware! Now `Bar.prototype.constructor` is gone,</span></span><br><span class="line"><span class="comment">// and might need to be manually "fixed" if you're</span></span><br><span class="line"><span class="comment">// in the habit of relying on such properties!</span></span><br><span class="line"></span><br><span class="line">Bar.prototype.myLabel = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.label;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Bar( <span class="string">"a"</span>, <span class="string">"obj a"</span> );</span><br><span class="line"></span><br><span class="line">a.myName(); <span class="comment">// "a"</span></span><br><span class="line">a.myLabel(); <span class="comment">// "obj a"</span></span><br></pre></td></tr></table></figure>
<p>而为什么不能直接 <code>Bar.prototype = Foo.prototype</code>; 因为修改 <code>Bar.prototype</code>的时候也会影响 <code>Foo.prototype</code>， 进而影响所有关联了<code>Foo.prototype</code>的对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// doesn't work like you want!</span></span><br><span class="line">Bar.prototype = Foo.prototype;</span><br><span class="line"></span><br><span class="line"><span class="comment">// works kinda like you want, but with</span></span><br><span class="line"><span class="comment">// side-effects you probably don't want :(</span></span><br><span class="line">Bar.prototype = <span class="keyword">new</span> Foo();</span><br></pre></td></tr></table></figure>
<p><code>Bar.prototype = new Foo();</code> 由于<code>new Foo()</code>是一个「constructor call」,会执行Foo函数体，进而造成一些不必要的影响, 例如对this进行意外的修改，或者Foo是一个高耗时的函数而影响了Bar的性能</p>
<p>由于继承实在是太过于常见了，所以ES6提供了一個工具函数来实现继承</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.setPrototypeOf( Bar.prototype, Foo.prototype );</span><br></pre></td></tr></table></figure>
<h4 id="查看“继承”关系">查看“继承”关系</h4><p>两个对象之间的关系</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Simply: does `b` appear anywhere in</span></span><br><span class="line"><span class="comment">// `c`s [[Prototype]] chain?</span></span><br><span class="line">b.isPrototypeOf( c );</span><br></pre></td></tr></table></figure>
<p>在 ES5中，我们可以使用 <code>Object.getPrototypeOf</code> 来查看关系</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.getPrototypeOf( a ) === Foo.prototype; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>也可以使用<code>__proto__</code>,不过这个不是所有浏览器都支持</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.__proto__ === <span class="constant">Foo</span>.prototype; <span class="regexp">//</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<h4 id="Object_Links">Object Links</h4><h5 id="Object-create()_is_a_hero"><code>Object.create()</code> is a hero</h5><blockquote>
<p>Object.create(..) creates a new object (bar) linked to the object we specified (foo), which gives us all the power (delegation) of the [[Prototype]] mechanism, but without any of the unnecessary complication of new functions acting as classes and constructor calls, confusing .prototype and .constructor references, or any of that extra stuff.</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = &#123;</span><br><span class="line">    something: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log( <span class="string">"Tell me something good..."</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bar = <span class="built_in">Object</span>.create( foo );</span><br><span class="line"></span><br><span class="line">bar.something(); <span class="comment">// Tell me something good...</span></span><br></pre></td></tr></table></figure>
<p>备注： <code>Object.create(null)</code> 创建出来的对象的<code>[[prototype]]</code>是null， 也就是没有原型链,  因为其「纯洁」性，我们可以用来创建字典(Dictionaries)而不必考虑原型链的影响而取到字典里不存在的值。</p>
<p>如果浏览器不支持<code>Object.create()</code>， 即ES5之前的版本，则需要提供一个兼容措施(Polyfilled)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="built_in">Object</span>.create) &#123;</span><br><span class="line">    <span class="built_in">Object</span>.create = <span class="function"><span class="keyword">function</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">        F.prototype = o;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> F();</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="总结">总结</h4><p>过去面向对象所用的一些术语是难以适用于js的世界的，<code>delegation</code>更合适用来描述js中的「原型继承」(<code>prototypal inheritance</code>);</p>
<blockquote>
<p>For a variety of reasons, not the least of which is terminology precedent, “inheritance” (and “prototypal inheritance”) and all the other OO terms just do not make sense when considering how JavaScript actually works (not just applied to our forced mental models). Instead, “<strong>delegation</strong>“ is a more appropriate term, because these relationships are <strong>not copies but delegation links.</strong></p>
</blockquote>
<hr>
<p>原文链接:  <a href="https://github.com/getify/You-Dont-Know-JS/blob/master/this%20&amp;%20object%20prototypes/ch5.md" target="_blank" rel="external">https://github.com/getify/You-Dont-Know-JS/blob/master/this%20&amp;%20object%20prototypes/ch5.md</a></p>
<h3 id="Behavior_Delegation"><a href="https://github.com/getify/You-Dont-Know-JS/blob/master/this%20&amp;%20object%20prototypes/ch6.md" target="_blank" rel="external">Behavior Delegation</a></h3><blockquote>
<p> Let’s now dig into how we could and should be thinking about the object [[Prototype]] mechanism in JS, in a much simpler and more straightforward way than the confusion of classes.</p>
</blockquote>
<h4 id="Delegation-Oriented_Design">Delegation-Oriented Design</h4><p>如何用 <code>behavior delegation</code> 的方式来进行思考? 下面的例子不同于传统用<code>类</code>来进行思考</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Task = &#123;</span><br><span class="line">    setID: <span class="function"><span class="keyword">function</span>(<span class="params">ID</span>) </span>&#123; <span class="keyword">this</span>.id = ID; &#125;,</span><br><span class="line">    outputID: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log( <span class="keyword">this</span>.id ); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// make `XYZ` delegate to `Task`</span></span><br><span class="line">XYZ = <span class="built_in">Object</span>.create( Task );</span><br><span class="line"></span><br><span class="line">XYZ.prepareTask = <span class="function"><span class="keyword">function</span>(<span class="params">ID,Label</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.setID( ID );</span><br><span class="line">    <span class="keyword">this</span>.label = Label;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">XYZ.outputTaskDetails = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.outputID();</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="keyword">this</span>.label );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在上面的代码中，<code>Task</code> 和 <code>XYZ</code> 不是<em>class</em>, 它们只是对象。</p>
<blockquote>
<p>In JavaScript, the [[Prototype]] mechanism links objects to other objects. There are no abstract mechanisms like “classes”, no matter how much you try to convince yourself otherwise. </p>
</blockquote>
<p>作者将这种方式称之为 <code>OLOO</code> (objects-linked-to-other-objects)， 这种和之前的类继承有以下区别：</p>
<ul>
<li>在类继承中，我们会写同名的函数，然后重写，而在<code>OOLO</code>中, 是相反过来的，函数是不重名的。对象的行为通过命名来进行区分，这样其实是可以提高代码的可读性的。</li>
<li>由于this的机制，当调用<code>prepareTask</code>的时候会调用 <code>this.setID(ID)</code>,  按照原型链机制，会找到Task上的setID方法，虽然setID不在XYZ上，但是this是指向 <code>XYZ</code>, 所以当后面运行 <code>this.outputID()</code>的时候可以看到输出是 我们设置的ID值</li>
</ul>
<blockquote>
<p><strong>Behavior Delegation</strong> means: let some object (XYZ) provide a delegation (to Task) for property or method references if not found on the object (XYZ).</p>
</blockquote>
<p>通过更多的例子来进一步解释</p>
<p><strong>OO</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params">who</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.me = who;</span><br><span class="line">&#125;</span><br><span class="line">Foo.prototype.identify = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"I am "</span> + <span class="keyword">this</span>.me;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Bar</span>(<span class="params">who</span>) </span>&#123;</span><br><span class="line">    Foo.call( <span class="keyword">this</span>, who );</span><br><span class="line">&#125;</span><br><span class="line">Bar.prototype = <span class="built_in">Object</span>.create( Foo.prototype );</span><br><span class="line"></span><br><span class="line">Bar.prototype.speak = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert( <span class="string">"Hello, "</span> + <span class="keyword">this</span>.identify() + <span class="string">"."</span> );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b1 = <span class="keyword">new</span> Bar( <span class="string">"b1"</span> );</span><br><span class="line"><span class="keyword">var</span> b2 = <span class="keyword">new</span> Bar( <span class="string">"b2"</span> );</span><br><span class="line"></span><br><span class="line">b1.speak();</span><br><span class="line">b2.speak();</span><br></pre></td></tr></table></figure>
<p><strong>OLOO</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Foo = &#123;</span><br><span class="line">    init: <span class="function"><span class="keyword">function</span>(<span class="params">who</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.me = who;</span><br><span class="line">    &#125;,</span><br><span class="line">    identify: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"I am "</span> + <span class="keyword">this</span>.me;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Bar = <span class="built_in">Object</span>.create( Foo );</span><br><span class="line"></span><br><span class="line">Bar.speak = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert( <span class="string">"Hello, "</span> + <span class="keyword">this</span>.identify() + <span class="string">"."</span> );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b1 = <span class="built_in">Object</span>.create( Bar );</span><br><span class="line">b1.init( <span class="string">"b1"</span> );</span><br><span class="line"><span class="keyword">var</span> b2 = <span class="built_in">Object</span>.create( Bar );</span><br><span class="line">b2.init( <span class="string">"b2"</span> );</span><br><span class="line"></span><br><span class="line">b1.speak();</span><br><span class="line">b2.speak();</span><br></pre></td></tr></table></figure>
<p><code>OLOO</code>和 <code>OO</code> 相比，没有了构造函数，new这些概念，更加简单，看更加实际的应用场景，看看classes和 object 的区别, 这里使用书中提到的 UI （Button）</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">// Parent class</span><br><span class="line"><span class="keyword">function</span> Widget(width,height) &#123;</span><br><span class="line">    this.width = width || <span class="number">50</span>;</span><br><span class="line">    this.height = height || <span class="number">50</span>;</span><br><span class="line">    this.<span class="variable">$elem</span> = null;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Widget.prototype.render = <span class="keyword">function</span>(<span class="variable">$where</span>)&#123;</span><br><span class="line">    if (this.<span class="variable">$elem</span>) &#123;</span><br><span class="line">        this.<span class="variable">$elem</span>.css( &#123;</span><br><span class="line">            width: this.width + <span class="string">"px"</span>,</span><br><span class="line">            height: this.height + <span class="string">"px"</span></span><br><span class="line">        &#125; ).appendTo( <span class="variable">$where</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// Child class</span><br><span class="line"><span class="keyword">function</span> Button(width,height,label) &#123;</span><br><span class="line">    // <span class="string">"super"</span> constructor call</span><br><span class="line">    Widget.call( this, width, height );</span><br><span class="line">    this.label = label || <span class="string">"Default"</span>;</span><br><span class="line"></span><br><span class="line">    this.<span class="variable">$elem</span> = $( <span class="string">"&lt;button&gt;"</span> ).text( this.label );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// make `Button` <span class="string">"inherit"</span> from `Widget`</span><br><span class="line">Button.prototype = Object.create( Widget.prototype );</span><br><span class="line"></span><br><span class="line">// override base <span class="string">"inherited"</span> `render(..)`</span><br><span class="line">Button.prototype.render = <span class="keyword">function</span>(<span class="variable">$where</span>) &#123;</span><br><span class="line">    // <span class="string">"super"</span> call</span><br><span class="line">    Widget.prototype.render.call( this, <span class="variable">$where</span> );</span><br><span class="line">    this.<span class="variable">$elem</span>.click( this.onClick.bind( this ) );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Button.prototype.onClick = <span class="keyword">function</span>(evt) &#123;</span><br><span class="line">    console.log( <span class="string">"Button '"</span> + this.label + <span class="string">"' clicked!"</span> );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">$( document ).ready( <span class="keyword">function</span>()&#123;</span><br><span class="line">    var <span class="variable">$body</span> = $( document.body );</span><br><span class="line">    var btn1 = new Button( <span class="number">125</span>, <span class="number">30</span>, <span class="string">"Hello"</span> );</span><br><span class="line">    var btn2 = new Button( <span class="number">150</span>, <span class="number">40</span>, <span class="string">"World"</span> );</span><br><span class="line"></span><br><span class="line">    btn1.render( <span class="variable">$body</span> );</span><br><span class="line">    btn2.render( <span class="variable">$body</span> );</span><br><span class="line">&#125; );</span><br></pre></td></tr></table></figure>
<p>上面的例子实在是有点麻烦，对吧，如果使用ES6来实现会简单，也更加流畅</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Widget &#123;</span><br><span class="line">    <span class="constructor"><span class="keyword">constructor</span>(width,height) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.width = width || <span class="number">50</span>;</span><br><span class="line">        <span class="keyword">this</span>.height = height || <span class="number">50</span>;</span><br><span class="line">        <span class="keyword">this</span>.$elem = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    render($where)&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.$elem) &#123;</span><br><span class="line">            <span class="keyword">this</span>.$elem.css( &#123;</span><br><span class="line">                width: <span class="keyword">this</span>.width + <span class="string">"px"</span>,</span><br><span class="line">                height: <span class="keyword">this</span>.height + <span class="string">"px"</span></span><br><span class="line">            &#125; ).appendTo( $where );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Button extends Widget &#123;</span><br><span class="line">    <span class="constructor"><span class="keyword">constructor</span>(width,height,label) </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>( width, height );</span><br><span class="line">        <span class="keyword">this</span>.label = label || <span class="string">"Default"</span>;</span><br><span class="line">        <span class="keyword">this</span>.$elem = $( <span class="string">"&lt;button&gt;"</span> ).text( <span class="keyword">this</span>.label );</span><br><span class="line">    &#125;</span><br><span class="line">    render($where) &#123;</span><br><span class="line">        <span class="keyword">super</span>( $where );</span><br><span class="line">        <span class="keyword">this</span>.$elem.click( <span class="keyword">this</span>.onClick.bind( <span class="keyword">this</span> ) );</span><br><span class="line">    &#125;</span><br><span class="line">    onClick(evt) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log( <span class="string">"Button '"</span> + <span class="keyword">this</span>.label + <span class="string">"' clicked!"</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$( <span class="built_in">document</span> ).ready( <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $body = $( <span class="built_in">document</span>.body );</span><br><span class="line">    <span class="keyword">var</span> btn1 = <span class="keyword">new</span> Button( <span class="number">125</span>, <span class="number">30</span>, <span class="string">"Hello"</span> );</span><br><span class="line">    <span class="keyword">var</span> btn2 = <span class="keyword">new</span> Button( <span class="number">150</span>, <span class="number">40</span>, <span class="string">"World"</span> );</span><br><span class="line"></span><br><span class="line">    btn1.render( $body );</span><br><span class="line">    btn2.render( $body );</span><br><span class="line">&#125; );</span><br></pre></td></tr></table></figure>
<p>尽管有了<code>class</code>， <code>super</code>等语法的辅助，但是这些依旧是不是真正的classes，依旧是基于原型链的机制。 只要选择了这种方式，尽管写起来容易了，但是依旧会碰到前几章提到的在js中模拟类继承遇到的各种头痛的问题，是要叫“智商税”的。</p>
<p>换成oloo来实现</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">var Widget = &#123;</span><br><span class="line">    init: function(width,height)&#123;</span><br><span class="line">        this.width = width || <span class="number">50</span>;</span><br><span class="line">        this.height = height || <span class="number">50</span>;</span><br><span class="line">        this.<span class="variable">$elem</span> = null;</span><br><span class="line">    &#125;,</span><br><span class="line">    insert: function(<span class="variable">$where</span>)&#123;</span><br><span class="line">        if (this.<span class="variable">$elem</span>) &#123;</span><br><span class="line">            this.<span class="variable">$elem</span>.css( &#123;</span><br><span class="line">                width: this.width + <span class="string">"px"</span>,</span><br><span class="line">                height: this.height + <span class="string">"px"</span></span><br><span class="line">            &#125; ).appendTo( <span class="variable">$where</span> );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var Button = Object.create( Widget );</span><br><span class="line"></span><br><span class="line">Button.setup = <span class="keyword">function</span>(width,height,label)&#123;</span><br><span class="line">    // delegated call</span><br><span class="line">    this.init( width, height );</span><br><span class="line">    this.label = label || <span class="string">"Default"</span>;</span><br><span class="line"></span><br><span class="line">    this.<span class="variable">$elem</span> = $( <span class="string">"&lt;button&gt;"</span> ).text( this.label );</span><br><span class="line">&#125;;</span><br><span class="line">Button.build = <span class="keyword">function</span>(<span class="variable">$where</span>) &#123;</span><br><span class="line">    // delegated call</span><br><span class="line">    this.insert( <span class="variable">$where</span> );</span><br><span class="line">    this.<span class="variable">$elem</span>.click( this.onClick.bind( this ) );</span><br><span class="line">&#125;;</span><br><span class="line">Button.onClick = <span class="keyword">function</span>(evt) &#123;</span><br><span class="line">    console.log( <span class="string">"Button '"</span> + this.label + <span class="string">"' clicked!"</span> );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">$( document ).ready( <span class="keyword">function</span>()&#123;</span><br><span class="line">    var <span class="variable">$body</span> = $( document.body );</span><br><span class="line"></span><br><span class="line">    var btn1 = Object.create( Button );</span><br><span class="line">    btn1.setup( <span class="number">125</span>, <span class="number">30</span>, <span class="string">"Hello"</span> );</span><br><span class="line"></span><br><span class="line">    var btn2 = Object.create( Button );</span><br><span class="line">    btn2.setup( <span class="number">150</span>, <span class="number">40</span>, <span class="string">"World"</span> );</span><br><span class="line"></span><br><span class="line">    btn1.build( <span class="variable">$body</span> );</span><br><span class="line">    btn2.build( <span class="variable">$body</span> );</span><br><span class="line">&#125; );</span><br></pre></td></tr></table></figure>
<p>注意，函数名是不同名的，我个人认为这种更加符合实际的情形，也让模型更加合理，同时也提高了可读性。</p>
<blockquote>
<p>With this OLOO-style approach, we don’t think of Widget as a parent and Button as a child. Rather, Widget is just an object and is sort of a utility collection that any specific type of widget might want to delegate to, and Button is also just a stand-alone object (with a delegation link to Widget, of course!).</p>
</blockquote>
<p>拿书中一个更加复杂的例子</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Parent class</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Controller</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.errors = [];</span><br><span class="line">&#125;</span><br><span class="line">Controller.prototype.showDialog = <span class="function"><span class="keyword">function</span>(<span class="params">title,msg</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// display title &amp; message to user in dialog</span></span><br><span class="line">&#125;;</span><br><span class="line">Controller.prototype.success = <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.showDialog( <span class="string">"Success"</span>, msg );</span><br><span class="line">&#125;;</span><br><span class="line">Controller.prototype.failure = <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.errors.push( err );</span><br><span class="line">    <span class="keyword">this</span>.showDialog( <span class="string">"Error"</span>, err );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// Child class</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">LoginController</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    Controller.call( <span class="keyword">this</span> );</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Link child class to parent</span></span><br><span class="line">LoginController.prototype = <span class="built_in">Object</span>.create( Controller.prototype );</span><br><span class="line">LoginController.prototype.getUser = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">document</span>.getElementById( <span class="string">"login_username"</span> ).value;</span><br><span class="line">&#125;;</span><br><span class="line">LoginController.prototype.getPassword = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">document</span>.getElementById( <span class="string">"login_password"</span> ).value;</span><br><span class="line">&#125;;</span><br><span class="line">LoginController.prototype.validateEntry = <span class="function"><span class="keyword">function</span>(<span class="params">user,pw</span>) </span>&#123;</span><br><span class="line">    user = user || <span class="keyword">this</span>.getUser();</span><br><span class="line">    pw = pw || <span class="keyword">this</span>.getPassword();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!(user &amp;&amp; pw)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.failure( <span class="string">"Please enter a username &amp; password!"</span> );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (pw.length &lt; <span class="number">5</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.failure( <span class="string">"Password must be 5+ characters!"</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// got here? validated!</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// Override to extend base `failure()`</span></span><br><span class="line">LoginController.prototype.failure = <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// "super" call</span></span><br><span class="line">    Controller.prototype.failure.call( <span class="keyword">this</span>, <span class="string">"Login invalid: "</span> + err );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// Child class</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AuthController</span>(<span class="params">login</span>) </span>&#123;</span><br><span class="line">    Controller.call( <span class="keyword">this</span> );</span><br><span class="line">    <span class="comment">// in addition to inheritance, we also need composition</span></span><br><span class="line">    <span class="keyword">this</span>.login = login;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Link child class to parent</span></span><br><span class="line">AuthController.prototype = <span class="built_in">Object</span>.create( Controller.prototype );</span><br><span class="line">AuthController.prototype.server = <span class="function"><span class="keyword">function</span>(<span class="params">url,data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $.ajax( &#123;</span><br><span class="line">        url: url,</span><br><span class="line">        data: data</span><br><span class="line">    &#125; );</span><br><span class="line">&#125;;</span><br><span class="line">AuthController.prototype.checkAuth = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> user = <span class="keyword">this</span>.login.getUser();</span><br><span class="line">    <span class="keyword">var</span> pw = <span class="keyword">this</span>.login.getPassword();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.login.validateEntry( user, pw )) &#123;</span><br><span class="line">        <span class="keyword">this</span>.server( <span class="string">"/check-auth"</span>,&#123;</span><br><span class="line">            user: user,</span><br><span class="line">            pw: pw</span><br><span class="line">        &#125; )</span><br><span class="line">        .then( <span class="keyword">this</span>.success.bind( <span class="keyword">this</span> ) )</span><br><span class="line">        .fail( <span class="keyword">this</span>.failure.bind( <span class="keyword">this</span> ) );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// Override to extend base `success()`</span></span><br><span class="line">AuthController.prototype.success = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// "super" call</span></span><br><span class="line">    Controller.prototype.success.call( <span class="keyword">this</span>, <span class="string">"Authenticated!"</span> );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// Override to extend base `failure()`</span></span><br><span class="line">AuthController.prototype.failure = <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// "super" call</span></span><br><span class="line">    Controller.prototype.failure.call( <span class="keyword">this</span>, <span class="string">"Auth Failed: "</span> + err );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> auth = <span class="keyword">new</span> AuthController(</span><br><span class="line">    <span class="comment">// in addition to inheritance, we also need composition</span></span><br><span class="line">    <span class="keyword">new</span> LoginController()</span><br><span class="line">);</span><br><span class="line">auth.checkAuth();</span><br></pre></td></tr></table></figure>
<p>使用<code>oloo</code>的方式来实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> LoginController = &#123;</span><br><span class="line">    errors: [],</span><br><span class="line">    getUser: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">document</span>.getElementById( <span class="string">"login_username"</span> ).value;</span><br><span class="line">    &#125;,</span><br><span class="line">    getPassword: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">document</span>.getElementById( <span class="string">"login_password"</span> ).value;</span><br><span class="line">    &#125;,</span><br><span class="line">    validateEntry: <span class="function"><span class="keyword">function</span>(<span class="params">user,pw</span>) </span>&#123;</span><br><span class="line">        user = user || <span class="keyword">this</span>.getUser();</span><br><span class="line">        pw = pw || <span class="keyword">this</span>.getPassword();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!(user &amp;&amp; pw)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.failure( <span class="string">"Please enter a username &amp; password!"</span> );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (pw.length &lt; <span class="number">5</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.failure( <span class="string">"Password must be 5+ characters!"</span> );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// got here? validated!</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    showDialog: <span class="function"><span class="keyword">function</span>(<span class="params">title,msg</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// display success message to user in dialog</span></span><br><span class="line">    &#125;,</span><br><span class="line">    failure: <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.errors.push( err );</span><br><span class="line">        <span class="keyword">this</span>.showDialog( <span class="string">"Error"</span>, <span class="string">"Login invalid: "</span> + err );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// Link `AuthController` to delegate to `LoginController`</span></span><br><span class="line"><span class="keyword">var</span> AuthController = <span class="built_in">Object</span>.create( LoginController );</span><br><span class="line"></span><br><span class="line">AuthController.errors = [];</span><br><span class="line">AuthController.checkAuth = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> user = <span class="keyword">this</span>.getUser();</span><br><span class="line">    <span class="keyword">var</span> pw = <span class="keyword">this</span>.getPassword();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.validateEntry( user, pw )) &#123;</span><br><span class="line">        <span class="keyword">this</span>.server( <span class="string">"/check-auth"</span>,&#123;</span><br><span class="line">            user: user,</span><br><span class="line">            pw: pw</span><br><span class="line">        &#125; )</span><br><span class="line">        .then( <span class="keyword">this</span>.accepted.bind( <span class="keyword">this</span> ) )</span><br><span class="line">        .fail( <span class="keyword">this</span>.rejected.bind( <span class="keyword">this</span> ) );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">AuthController.server = <span class="function"><span class="keyword">function</span>(<span class="params">url,data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $.ajax( &#123;</span><br><span class="line">        url: url,</span><br><span class="line">        data: data</span><br><span class="line">    &#125; );</span><br><span class="line">&#125;;</span><br><span class="line">AuthController.accepted = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.showDialog( <span class="string">"Success"</span>, <span class="string">"Authenticated!"</span> )</span><br><span class="line">&#125;;</span><br><span class="line">AuthController.rejected = <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.failure( <span class="string">"Auth Failed: "</span> + err );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="总结-1">总结</h4><blockquote>
<p>Classes and inheritance are a design pattern you can choose, or not choose, in your software architecture.</p>
</blockquote>
<p><code>OO</code>只是一种软件架构，在js中，不是唯一的手段，<code>OLOO</code> 是另外一种更加简单的方式。</p>
</span>
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/javascript/" rel="tag">#javascript</a>
          
            <a href="/tags/编程语言/" rel="tag">#编程语言</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/03/24/Min-和-Max方法的实现和用法/" rel="prev">Min和Max方法的实现和用法</a>
            
          </div>

          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/01/26/node-webkit开发过程总结/" rel="next">使用Node-wekit开发桌面程序总结</a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

 </div>

        

        
          <div class="comments" id="comments">
            
          </div>
        
      </div>

      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/default_avatar.jpg" alt="Andrew Zhang" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Andrew Zhang</p>
        </div>
        <p class="site-description motion-element" itemprop="description"></p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">40</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">19</span>
              <span class="site-state-item-name">分类</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">40</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator"></div>
          <div class="post-toc">
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#this_&_Object_Prototypes"><span class="nav-number">1.</span> <span class="nav-text">this & Object Prototypes</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#this"><span class="nav-number">1.1.</span> <span class="nav-text">this</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4条规则"><span class="nav-number">1.1.1.</span> <span class="nav-text">4条规则</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-_Default_Binding"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">1. Default Binding</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-_Implicit_Binding"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">2. Implicit Binding</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-_Explicit_Binding"><span class="nav-number">1.1.1.3.</span> <span class="nav-text">3. Explicit Binding</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-_new_Binding"><span class="nav-number">1.1.1.4.</span> <span class="nav-text">4. new Binding</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4条规则的优先级"><span class="nav-number">1.1.2.</span> <span class="nav-text">4条规则的优先级</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#需要注意的点"><span class="nav-number">1.1.3.</span> <span class="nav-text">需要注意的点</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#使用更加安全的this"><span class="nav-number">1.1.3.1.</span> <span class="nav-text">使用更加安全的this</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Object"><span class="nav-number">1.2.</span> <span class="nav-text">Object</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#javascript中的6种基本类型（Primary_Type）"><span class="nav-number">1.2.1.</span> <span class="nav-text">javascript中的6种基本类型（Primary Type）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#内置对象（Built-in_Objects）"><span class="nav-number">1.2.2.</span> <span class="nav-text">内置对象（Built-in Objects）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#一些Object的细节点"><span class="nav-number">1.2.3.</span> <span class="nav-text">一些Object的细节点</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#in_和_hasOwnProperty的区别"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">in 和 hasOwnProperty的区别</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#可以枚举（Enumeration），不代表不能访问"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">可以枚举（Enumeration），不代表不能访问</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mixing_(Up)_“Class”_Objects"><span class="nav-number">1.3.</span> <span class="nav-text">Mixing (Up) “Class” Objects</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Prototype"><span class="nav-number">1.4.</span> <span class="nav-text">Prototype</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#需要注意的地方"><span class="nav-number">1.4.1.</span> <span class="nav-text">需要注意的地方</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#引用"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">引用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Shadowing"><span class="nav-number">1.4.1.2.</span> <span class="nav-text">Shadowing</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Object-prototype"><span class="nav-number">1.4.2.</span> <span class="nav-text">Object.prototype</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#设置Object的值"><span class="nav-number">1.4.3.</span> <span class="nav-text">设置Object的值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#容易混乱的地方"><span class="nav-number">1.4.4.</span> <span class="nav-text">容易混乱的地方</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#prototype"><span class="nav-number">1.4.4.1.</span> <span class="nav-text">prototype</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Functions_不是「构造函数」"><span class="nav-number">1.4.4.2.</span> <span class="nav-text">Functions 不是「构造函数」</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#模拟继承"><span class="nav-number">1.4.5.</span> <span class="nav-text">模拟继承</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查看“继承”关系"><span class="nav-number">1.4.6.</span> <span class="nav-text">查看“继承”关系</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Object_Links"><span class="nav-number">1.4.7.</span> <span class="nav-text">Object Links</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Object-create()_is_a_hero"><span class="nav-number">1.4.7.1.</span> <span class="nav-text">Object.create() is a hero</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结"><span class="nav-number">1.4.8.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Behavior_Delegation"><span class="nav-number">1.5.</span> <span class="nav-text">Behavior Delegation</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Delegation-Oriented_Design"><span class="nav-number">1.5.1.</span> <span class="nav-text">Delegation-Oriented Design</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结-1"><span class="nav-number">1.5.2.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator"></div>
        </section>
      

    </div>
  </aside>


    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner"> <div class="copyright" >
  
  &copy; &nbsp; 
  <span itemprop="copyrightYear">2015</span>
  <span class="with-love">
    <i class="icon-next-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Andrew Zhang</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>


 </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    
    

  


  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.1"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.1"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.5.1" id="motion.global"></script>




  <script type="text/javascript" src="/js/nav-toggle.js?v=0.4.5.1"></script>
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  
<script type="text/javascript" src="/js/bootstrap.scrollspy.js?v=0.4.5.1" id="bootstrap.scrollspy.custom"></script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 0.4 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    var $tocContent = $('.post-toc-content');
    if (isDesktop() && CONFIG.sidebar === 'post') {
      if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
        displaySidebar();
      }
    }
  });
</script>



  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
      if (isMobile()) {
        FastClick.attach(document.body);
      }
    });
  </script>

  

  
  

  
  <script type="text/javascript" src="/js/lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/images/loading.gif",
        effect: "fadeIn"
      });
    });
  </script>
</body>
</html>
