<!doctype html>
<html class="theme-next use-motion ">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />








  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>




<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.5.1"/>




  <meta name="keywords" content="Hexo,next" />





  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.1" />


<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Code Me">
<meta property="og:url" content="http://zhangmhao.github.io/page/4/index.html">
<meta property="og:site_name" content="Code Me">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Code Me">
<meta name="twitter:description">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'post'
  };
</script>

  <title> Code Me </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  



  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand" rel="start">
      <span class="logo">
        <i class="icon-next-logo"></i>
      </span>
      <span class="site-title">Code Me</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon icon-next-home"></i> <br />
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            <i class="menu-item-icon icon-next-archives"></i> <br />
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            <i class="menu-item-icon icon-next-tags"></i> <br />
            标签
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content"> 
  <section id="posts" class="posts-expand">
    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2013/12/20/有关前端路由Roter的思考/" itemprop="url">
                关于前端路由是否应该支持热插拔的讨论
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2013-12-20T00:00:00+08:00" content="2013-12-20">
            2013-12-20
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/前端开发/" itemprop="url" rel="index">
                  <span itemprop="name">前端开发</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>在阅读这篇文章 <a href="http://blog.shinetech.com/2013/11/26/backbone-antipatterns/" target="_blank" rel="external">http://blog.shinetech.com/2013/11/26/backbone-antipatterns/</a>  的评论时发现了下面这段评论</p>
<blockquote>
<p>Fantastic writeup. I whole-heartedly agree with all points, although maybe in a different priority order. The only other major one that comes to my mind that I see very frequently is building a stateful application around a Router. If your application needs to manage state, do it with a designated model. Routers should simply be another I/O channel, much like buttons in the display or keys on the keyboard. A router should simply pass-through route data, and update the URL to reflect internal state… However, you should still have a fully functional app without in stanching a router.</p>
</blockquote>
<p>而博主是这样子回答的：</p>
<blockquote>
<p>I agree with your concerns about routers, however I didn’t make an antipattern because I couldn’t clearly articulate my reservations at the time.<br>I have seen problems where people make parts of their app route-driven for no good reason. This causes issues because the router is effectively a global object, with all of the attendant issues that come with globally accessible objects – hard to test, gets bloated, ‘god-class’ tendencies. Doing routes properly is hard. By extension, doing everything with routes makes everything hard.<br>I think it’s important to have a clearly defined policy as to what’s going to have a route and what’s not. In many ways what’s routeable is a UX question first – what needs to be bookmarkable, what needs to be navigable using the back-buttons, what needs SEO – and only secondarily an architectural issue. In my opinion, many people get this around the wrong way.  </p>
</blockquote>
<p>评论的观点是，系统不应该依赖于路由，没有路由，App应该要可以继续正常使用，路由只是App内部状态的一个表示。这个问题我也纠结过，就是应用应不应该通过路由驱动，个人觉得，这个只是一个设计问题罢了，对于web应用来讲，可以通过uri来定位页面资源（弹出窗口等），这个是非常常见的需求，至于路由应不应该成为整个应用的驱动，这个没有什么太大所谓。</p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2013/11/21/高效率数组去重/" itemprop="url">
                高效率数组去重的几种方式
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2013-11-21T00:00:00+08:00" content="2013-11-21">
            2013-11-21
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/前端开发/" itemprop="url" rel="index">
                  <span itemprop="name">前端开发</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>最近遇到数组的去重的问题，参考了网上的资料，发觉这个问题涉及到知识点还挺多，不仅仅是js，还有性能优化上的一些权衡，针对一个具体的场景来寻找一个最优的方案，不追求一个函数可以适应所有的场景，因为这样的函数一般性能都不好；</p>
<h3 id="V1:_这是最直接的写法，但是需要2重循环">V1: 这是最直接的写法，但是需要2重循环</h3><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function uniqueV1(arr) &#123;</span><br><span class="line">  <span class="keyword">var</span> <span class="keyword">ret</span> = []</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = 0; i &lt; arr.length; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> item = arr[i]</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">ret</span>.indexOf(item) === -1) &#123;</span><br><span class="line">      <span class="keyword">ret</span>.push(item)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">ret</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="V2:_通过构建Hash">V2: 通过构建Hash</h3><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">uniqueV2</span><span class="params">(arr)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> ret = []</span><br><span class="line">  <span class="keyword">var</span> hash = &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> item = arr[i]</span><br><span class="line">    <span class="keyword">var</span> key = <span class="keyword">typeof</span>(item) + item</span><br><span class="line">    <span class="keyword">if</span> (hash[key] !== <span class="number">1</span>) &#123;</span><br><span class="line">      ret.push(item)</span><br><span class="line">      hash[key] = <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是这个函数无法认出 <code>uniqueV2([ new String(1), new Number(1) ])</code>, 因为这两者的<code>.typeof()</code>的结果都是<code>object</code></p>
<h3 id="V3:_仅仅针对字符串数组的去重">V3: 仅仅针对字符串数组的去重</h3><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function uniqueV3(arr) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="literal">result</span> = &#123;&#125;;</span><br><span class="line">    arr.forEach(function (element) &#123;</span><br><span class="line">        <span class="literal">result</span>[element] = <span class="number">1</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Object</span>.keys(<span class="literal">result</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个函数是高效的，同样无法区分类型，例如下面的例子，无法区分 String 和 Number</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uniqueV3([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>])  返回值 [<span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>, <span class="string">"4"</span>, <span class="string">"5"</span>]</span><br><span class="line">uniqueV3([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>,<span class="string">'5'</span>]) 返回值 [<span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>, <span class="string">"4"</span>, <span class="string">"5"</span>]</span><br></pre></td></tr></table></figure>
<h3 id="V4_排序之后再去两两比较进行去重">V4 排序之后再去两两比较进行去重</h3><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">uniqueV5</span><span class="params">(results)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> elem,</span><br><span class="line">        duplicates = [],</span><br><span class="line">        hasDuplicate,</span><br><span class="line">        j = <span class="number">0</span>,</span><br><span class="line">        i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> sortOrder = <span class="function"><span class="keyword">function</span><span class="params">( a, b )</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ( a === b ) &#123;</span><br><span class="line">            hasDuplicate = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a - b;</span><br><span class="line">    &#125;;</span><br><span class="line">    results.sort(sortOrder);</span><br><span class="line">    <span class="keyword">if</span> (hasDuplicate) &#123;</span><br><span class="line">        <span class="keyword">while</span> ( (elem = results[i++]) ) &#123;</span><br><span class="line">            <span class="keyword">if</span> ( elem === results[ i ] ) &#123;</span><br><span class="line">                j = duplicates.push( i );</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> ( j-- ) &#123;</span><br><span class="line">            results.splice( duplicates[ j ], <span class="number">1</span> );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> results;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="总结">总结</h2><p>注意： 以上这4个版本的程序没有考虑过浏览器兼容性，如果把这一点也考虑进去，估计有一些点需要重新修改；例如 indexOf在 IE6-8下是没有的。</p>
<blockquote>
<p>针对具体场景寻找一个最优化的解决方案，越简单越好</p>
</blockquote>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2013/11/07/javascript绝句欣赏/" itemprop="url">
                javascript绝句欣赏
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2013-11-07T00:00:00+08:00" content="2013-11-07">
            2013-11-07
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/前端开发/" itemprop="url" rel="index">
                  <span itemprop="name">前端开发</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 取整同时转成数值型：</span></span><br><span class="line"><span class="string">'10.567890'</span>|<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//结果: 10</span></span><br><span class="line"></span><br><span class="line"><span class="string">'10.567890'</span>^<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//结果: 10</span></span><br><span class="line"></span><br><span class="line">-<span class="number">2.23456789</span>|<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//结果: -2</span></span><br><span class="line"></span><br><span class="line">~~-<span class="number">2.23456789</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//结果: -2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2. 日期转数值：</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> d = +<span class="keyword">new</span> <span class="built_in">Date</span>(); <span class="comment">//1295698416792</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//3. 类数组对象转数组：</span></span><br><span class="line"><span class="keyword">var</span> arr = [].slice.call(<span class="built_in">arguments</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//4. 漂亮的随机码：</span></span><br><span class="line"><span class="built_in">Math</span>.random().toString(<span class="number">16</span>).substring(<span class="number">2</span>); <span class="comment">//14位</span></span><br><span class="line"><span class="built_in">Math</span>.random().toString(<span class="number">36</span>).substring(<span class="number">2</span>); <span class="comment">//11位</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//5. 合并数组：</span></span><br><span class="line"><span class="keyword">var</span> a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">var</span> b = [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>];</span><br><span class="line"><span class="built_in">Array</span>.prototype.push.apply(a, b);</span><br><span class="line">uneval(a); <span class="comment">//[1,2,3,4,5,6]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. 用0补全位数：</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">prefixInteger</span>(<span class="params">num, length</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (num / <span class="built_in">Math</span>.pow(<span class="number">10</span>, length)).toFixed(length).substr(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 7. 交换值：</span></span><br><span class="line">a= [b, b=a][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 8. 将一个数组插入另一个数组的指定位置：</span></span><br><span class="line"><span class="keyword">var</span> a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>];</span><br><span class="line"><span class="keyword">var</span> b = [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>];</span><br><span class="line"><span class="keyword">var</span> insertIndex = <span class="number">3</span>;</span><br><span class="line">a.splice.apply(a, <span class="built_in">Array</span>.concat(insertIndex, <span class="number">0</span>, b));</span><br><span class="line"><span class="comment">// a: 1,2,3,4,5,6,7,8,9</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 9. 删除数组元素：</span></span><br><span class="line"><span class="keyword">var</span> a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line">a.splice(<span class="number">3</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 10. 快速取数组最大和最小值</span></span><br><span class="line"><span class="built_in">Math</span>.max.apply(<span class="built_in">Math</span>, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]) <span class="comment">//3</span></span><br><span class="line"><span class="built_in">Math</span>.min.apply(<span class="built_in">Math</span>, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]) <span class="comment">//1</span></span><br><span class="line"><span class="comment">//(出自http://ejohn.org/blog/fast-javascript-maxmin/)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 11. 条件判断：</span></span><br><span class="line"><span class="keyword">var</span> a = b &amp;&amp; <span class="number">1</span>;</span><br><span class="line"><span class="comment">// 相当于</span></span><br><span class="line"><span class="keyword">if</span> (b) &#123;</span><br><span class="line">  a = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = b || <span class="number">1</span>;</span><br><span class="line"><span class="comment">// 相当于</span></span><br><span class="line"><span class="keyword">if</span> (b) &#123;</span><br><span class="line">  a = b;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  a = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">12.</span> 判断IE:</span><br><span class="line"><span class="keyword">var</span> ie = <span class="comment">/*@cc_on !@*/</span><span class="literal">false</span>;</span><br></pre></td></tr></table></figure>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2013/10/31/Javascript的Object比较/" itemprop="url">
                如何进行Object的比较?
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2013-10-31T00:00:00+08:00" content="2013-10-31">
            2013-10-31
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/前端开发/" itemprop="url" rel="index">
                  <span itemprop="name">前端开发</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>在日常编程中，Object的比较是一个比较常见的问题，没有所谓的可以通用的方法，依旧是具体问题具体分析，在速度和正确性上进行权衡</p>
<h3 id="1-_JSON-stringify_简单快速，有限制">1. <code>JSON.stringify</code> 简单快速，有限制</h3><p>简单快速, 用于比较JSON风格的对象，但是不能有Function和DOM在对象里面</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">JSON</span>.stringify(obj1) === <span class="built_in">JSON</span>.stringify(obj2);</span><br></pre></td></tr></table></figure>
<h3 id="2-_慢一些，却更加普适用">2. 慢一些，却更加普适用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepCompare</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> i, l, leftChain, rightChain;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">compare2Objects</span> (<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// remember that NaN === NaN returns false</span></span><br><span class="line">    <span class="comment">// and isNaN(undefined) returns true</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">isNaN</span>(x) &amp;&amp; <span class="built_in">isNaN</span>(y) &amp;&amp; <span class="keyword">typeof</span> x === <span class="string">'number'</span> &amp;&amp; <span class="keyword">typeof</span> y === <span class="string">'number'</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Compare primitives and functions.     </span></span><br><span class="line">    <span class="comment">// Check if both arguments link to the same object.</span></span><br><span class="line">    <span class="comment">// Especially useful on step when comparing prototypes</span></span><br><span class="line">    <span class="keyword">if</span> (x === y) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Works in case when functions are created in constructor.</span></span><br><span class="line">    <span class="comment">// Comparing dates is a common scenario. Another built-ins?</span></span><br><span class="line">    <span class="comment">// We can even handle functions passed across iframes</span></span><br><span class="line">    <span class="keyword">if</span> ((<span class="keyword">typeof</span> x === <span class="string">'function'</span> &amp;&amp; <span class="keyword">typeof</span> y === <span class="string">'function'</span>) ||</span><br><span class="line">       (x <span class="keyword">instanceof</span> <span class="built_in">Date</span> &amp;&amp; y <span class="keyword">instanceof</span> <span class="built_in">Date</span>) ||</span><br><span class="line">       (x <span class="keyword">instanceof</span> <span class="built_in">RegExp</span> &amp;&amp; y <span class="keyword">instanceof</span> <span class="built_in">RegExp</span>) ||</span><br><span class="line">       (x <span class="keyword">instanceof</span> <span class="built_in">String</span> &amp;&amp; y <span class="keyword">instanceof</span> <span class="built_in">String</span>) ||</span><br><span class="line">       (x <span class="keyword">instanceof</span> <span class="built_in">Number</span> &amp;&amp; y <span class="keyword">instanceof</span> <span class="built_in">Number</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> x.toString() === y.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// At last checking prototypes as good a we can</span></span><br><span class="line">    <span class="keyword">if</span> (!(x <span class="keyword">instanceof</span> <span class="built_in">Object</span> &amp;&amp; y <span class="keyword">instanceof</span> <span class="built_in">Object</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (x.isPrototypeOf(y) || y.isPrototypeOf(x)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (x.constructor !== y.constructor) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (x.prototype !== y.prototype) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check for infinitive linking loops</span></span><br><span class="line">    <span class="keyword">if</span> (leftChain.indexOf(x) &gt; -<span class="number">1</span> || rightChain.indexOf(y) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Quick checking of one object beeing a subset of another.</span></span><br><span class="line">    <span class="comment">// <span class="doctag">todo:</span> cache the structure of arguments[0] for performance</span></span><br><span class="line">    <span class="keyword">for</span> (p <span class="keyword">in</span> y) &#123;</span><br><span class="line">        <span class="keyword">if</span> (y.hasOwnProperty(p) !== x.hasOwnProperty(p)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> y[p] !== <span class="keyword">typeof</span> x[p]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (p <span class="keyword">in</span> x) &#123;</span><br><span class="line">        <span class="keyword">if</span> (y.hasOwnProperty(p) !== x.hasOwnProperty(p)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> y[p] !== <span class="keyword">typeof</span> x[p]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (<span class="keyword">typeof</span> (x[p])) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'object'</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'function'</span>:</span><br><span class="line"></span><br><span class="line">                leftChain.push(x);</span><br><span class="line">                rightChain.push(y);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (!compare2Objects (x[p], y[p])) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                leftChain.pop();</span><br><span class="line">                rightChain.pop();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">if</span> (x[p] !== y[p]) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">arguments</span>.length &lt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">//Die silently? Don't know how to handle such case, please help...</span></span><br><span class="line">    <span class="comment">// throw "Need two or more arguments to compare";</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">1</span>, l = <span class="built_in">arguments</span>.length; i &lt; l; i++) &#123;</span><br><span class="line"></span><br><span class="line">      leftChain = []; <span class="comment">//<span class="doctag">Todo:</span> this can be cached</span></span><br><span class="line">      rightChain = [];</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!compare2Objects(<span class="built_in">arguments</span>[<span class="number">0</span>], <span class="built_in">arguments</span>[i])) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2013/10/15/前端性能优化总结/" itemprop="url">
                前端性能优化技巧总结
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2013-10-15T00:00:00+08:00" content="2013-10-15">
            2013-10-15
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/前端开发/" itemprop="url" rel="index">
                  <span itemprop="name">前端开发</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>这一段时间一直在做性能优化相关的共工作，做一个总结；关于性能优化这一块，如果从前端的角度来看。</p>
<h3 id="首先要解决的就是页面的大小问题">首先要解决的就是页面的大小问题</h3><p>页面越小，加载速度就越快。而css文件和script文件的位置对页面展现给用户的时间也是影响很大的</p>
<p>总结了一下页面大小优化手段：</p>
<ol>
<li>html尽可能简单（例如减少html标签的嵌套，使用短html标签p,i,ul,li 等等）</li>
<li>不常用的页面采取分页（超链接跳转，需要刷新），或者异步加载的手段（可以免刷新）</li>
<li>线上使用压缩之后的html（可以减少不必要的空格和换行）</li>
<li>css置顶，script置底，script还可以使用defer,async方式控制脚本执行时机</li>
<li>使用前端模板引擎</li>
</ol>
<h4 id="页面大小问题优化之后就是页面资源网络请求的问题">页面大小问题优化之后就是页面资源网络请求的问题</h4><p>一个网页的加载时间 80% 是消耗在 css，script，img这些资源的加载，减少请求个数就是优化的关键。而方法也较多，合并css和script文件，CSS Sprites ，baes64图片资源(inline image)等这些方法都是比较流行的.</p>
<h3 id="而减少了网络请求的个数之后，如何让剩下的这些不可避免的网络请求的响应更快呢？">而减少了网络请求的个数之后，如何让剩下的这些不可避免的网络请求的响应更快呢？</h3><p>常见的方法有：</p>
<ol>
<li>减少DNS查询个数（合适安排domain个数，DNS查询时间在移动端还是又较为显著的影响）</li>
<li>避免页面跳转</li>
<li>缓存ajax</li>
<li>使用cdn</li>
<li>开启gzip</li>
<li>减少cookie大小（目的也是为了减少http请求的大小，避免分包发送）</li>
<li>图片延迟加载（减少请求数目，避免阻塞，目前大多数站点均有采用）</li>
<li>使用cookie无关的域名来传输静态内容（减少Header的大小）</li>
<li>application cache等缓存静态资源</li>
</ol>
<p>如果文件都加载下来了，下面会影响性能的就是css和javascript这两块了。主要是很多最佳实践的东西，这里就不写了。</p>
<h3 id="关于浏览器在网络处理这一块的资料">关于浏览器在网络处理这一块的资料</h3><p>关于浏览器在网络请求并发数的一些问题，向内核组的同学咨询之后，大概总结如下</p>
<p>一个Host下面的并发数是20个，host越多，并发数越大</p>
<p>并发总数 = Host数目 * 20</p>
<p>然而真实的并发数与具体环境的网络并发数也是相关的，android和ios，或者塞班，可能都会有所差别。</p>
<p>一个http请求在大多数网络，一个包最多可承载的数据长度是1388字节，如果超出会被分成多个包；如果可以把每个请求限制在1388个字节之内，那么就减少请求的开销。</p>
<p>不过这个1388的数值，在其他国家或地区可能会有差别。这个暂时无具体数据可以提供。</p>
<p>参考：</p>
<ol>
<li><a href="https://developers.google.com/speed/docs/best-practices/request?hl=zh-CN&amp;csw=1" target="_blank" rel="external">https://developers.google.com/speed/docs/best-practices/request?hl=zh-CN&amp;csw=1</a></li>
<li><a href="http://www.zhihu.com/question/21057713" target="_blank" rel="external">http://www.zhihu.com/question/21057713</a></li>
<li><a href="http://mobile.smashingmagazine.com/2013/04/03/build-fast-loading-mobile-website/" target="_blank" rel="external">http://mobile.smashingmagazine.com/2013/04/03/build-fast-loading-mobile-website/</a> （推荐）</li>
<li><a href="http://mobile.smashingmagazine.com/2013/08/12/creating-high-performance-mobile-websites/" target="_blank" rel="external">http://mobile.smashingmagazine.com/2013/08/12/creating-high-performance-mobile-websites/</a></li>
<li><a href="https://github.com/cssmagic/blog/issues/20" target="_blank" rel="external">https://github.com/cssmagic/blog/issues/20</a></li>
<li><a href="http://51degrees.mobi/ressinfographic" target="_blank" rel="external">http://51degrees.mobi/ressinfographic</a> </li>
<li><a href="http://www.infoq.com/cn/articles/front-end-engineering-and-performance-optimization-part1" target="_blank" rel="external">http://www.infoq.com/cn/articles/front-end-engineering-and-performance-optimization-part1</a></li>
<li><a href="http://www.infoq.com/cn/articles/front-end-engineering-and-performance-optimization-part2" target="_blank" rel="external">http://www.infoq.com/cn/articles/front-end-engineering-and-performance-optimization-part2</a></li>
<li><a href="http://velocity.oreilly.com.cn/2013/index.php?func=session&amp;id=14" target="_blank" rel="external">http://velocity.oreilly.com.cn/2013/index.php?func=session&amp;id=14</a> (里面的PPt不错)</li>
<li><a href="http://www.cnblogs.com/developersupport/p/3248695.html" target="_blank" rel="external">http://www.cnblogs.com/developersupport/p/3248695.html</a> (推荐﻿)  </li>
</ol>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2013/10/12/Cookie操作/" itemprop="url">
                如何通过javascript操作Cookie?
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2013-10-12T00:00:00+08:00" content="2013-10-12">
            2013-10-12
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/前端开发/" itemprop="url" rel="index">
                  <span itemprop="name">前端开发</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h3 id="获取所有cookie">获取所有cookie</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> allCookies = <span class="built_in">document</span>.cookie;</span><br></pre></td></tr></table></figure>
<p>返回格式是 : “name=andrew; address=Guangzhou;”</p>
<h3 id="设置新的cookie">设置新的cookie</h3><p>cookie不能有分号，逗号，空格，所以可以使用encodeURIComponent对字符串进行处理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.cookie = updatedCookie;</span><br><span class="line"><span class="built_in">document</span>.cookie = <span class="string">"version="</span> + <span class="built_in">encodeURIComponent</span>(<span class="built_in">document</span>.lastModified);</span><br></pre></td></tr></table></figure>
<p>这个赋值操作是一个增量，不会覆盖原来的cookie,例如</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.cookie = <span class="string">'home=Chaozhou'</span>; <span class="regexp">//</span>这时<span class="built_in">document</span>.cookie的值是<span class="string">"name=andrew; address=Guangzhou; home=Chaozhou"</span></span><br></pre></td></tr></table></figure>
<h3 id="检测cookie是否启用">检测cookie是否启用</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">navigator</span><span class="class">.cookieEnabled</span></span><br></pre></td></tr></table></figure>
<p>这个接口有些浏览器不支持 ，不支持的就直接操作cookie来判断其支持</p>
<h3 id="Cookie的生存周期">Cookie的生存周期</h3><p>当用户退出浏览器，cookie的生命就结束了，这里区别于sessionStorage，因为cookie的范围不限制与一个浏览器窗口或者tab页，而且生命周期与浏览器进程同生共死</p>
<p><code>max-age</code> 设置了cookie的生存周期，浏览器会将cookie保存在文件中，直到过期了再删除。</p>
<h4 id="Cookie的Scope">Cookie的Scope</h4><p>这个是一段对cookie scope的描述</p>
<blockquote>
<p>Google’s Browser Security Handbook says: by default, cookie scope is limited to all URLs on the current host name - and not bound to port or protocol information. and some lines later There is no way to limit cookies to a single DNS name only […] likewise, there is no way to limit them to a specific port. (Also, keep in mind, that IE does not factor port numbers into its same-origin policy at all.) </p>
</blockquote>
<p>也就是说，cookie只受到 <code>domian</code> 和 <code>path</code>的限制，与protocol (https或者http)和 port(端口号)是不相关的，也就是说，以下3个网站读取的都是同一个cookie</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">https:</span><span class="comment">// www.example.com</span></span><br><span class="line"><span class="string">http:</span><span class="comment">//www.example.com</span></span><br><span class="line"><span class="string">http:</span><span class="comment">//www.example.com:123</span></span><br></pre></td></tr></table></figure>
<p>在 <a href="http://www.example.com/catalog/index.html" target="_blank" rel="external">http://www.example.com/catalog/index.html</a> 创建一个cookie之后，对于下面两个网址是可见的：</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/www.example.com/catalog</span><span class="regexp">/order.html  </span><br><span class="line">http:/</span><span class="regexp">/www.example.com/catalog</span><span class="regexp">/widgets/index</span>.html,</span><br></pre></td></tr></table></figure>
<p>但是对于下面这个网址是不可见的，因为path不同</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">http:</span><span class="comment">//www.example.com/about.html.</span></span><br></pre></td></tr></table></figure>
<p>如果将path设置为’/‘ 则对于整个 <a href="http://www.example.com都是可见的,这样子就有点类似与localStorage，而且所有请求都会带上该cookie" target="_blank" rel="external">http://www.example.com都是可见的,这样子就有点类似与localStorage，而且所有请求都会带上该cookie</a></p>
<p>设置domain属性，可以在子域名上共享cookie。例如</p>
<p>如果要让 order.example.com可以读取 category.example.com 设置的cookie，那就要让选项如下</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="setting">path=<span class="value"><span class="string">'/'</span></span></span></span><br><span class="line"><span class="setting">domain=<span class="value"><span class="string">'.example.com'</span></span></span></span><br></pre></td></tr></table></figure>
<p>最后一个选项是 secure  设置是否是否仅仅通过 https请求</p>
<h3 id="简单的几个函数，辅助Cookie操作">简单的几个函数，辅助Cookie操作</h3><h4 id="Get_Cookie">Get Cookie</h4><p><strong>方法1: 简单，通过正则表达式来进行查找目标</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCookie</span>(<span class="params">k,r</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (r=<span class="built_in">RegExp</span>(<span class="string">'(^|; )'</span>+ <span class="built_in">encodeURIComponent</span>(k) + <span class="string">'=([^;]*)'</span>).exec(<span class="built_in">document</span>.cookie)) ? r[<span class="number">2</span>] : <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>方法2: 分割字符串</strong></p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCookie</span><span class="params">(name)</span> &#123;</span></span><br><span class="line">    name += <span class="string">'='</span>;</span><br><span class="line">    <span class="keyword">for</span> (var ca = document.cookie.split(/;\s*/), <span class="built_in">i</span> = ca.<span class="built_in">length</span> - <span class="number">1</span>; <span class="built_in">i</span> &gt;= <span class="number">0</span>; <span class="built_in">i</span>--)</span><br><span class="line">        <span class="keyword">if</span> (!ca<span class="matrix">[i]</span>.indexOf(name))</span><br><span class="line">            <span class="keyword">return</span> ca<span class="matrix">[i]</span>.replace(name, <span class="string">''</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>方法3: 建立Hash Map</strong></p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="list">(<span class="keyword">function</span><span class="list">()</span><span class="collection">&#123;</span><br><span class="line">    var cookies;</span><br><span class="line"></span><br><span class="line">    function getCookie<span class="list">(<span class="keyword"><span class="built_in">name</span></span>, c, C, i)</span><span class="collection">&#123;</span><br><span class="line">        if<span class="list">(<span class="keyword">cookies</span>)</span><span class="collection">&#123; return cookies<span class="collection">[name]</span><span class="comment">; &#125;</span></span><br><span class="line"></span><br><span class="line">        c = document.cookie.split<span class="list">(<span class="keyword">';</span> ')</span><span class="comment">;</span></span><br><span class="line">        cookies = <span class="collection">&#123;&#125;</span><span class="comment">;</span></span><br><span class="line"></span><br><span class="line">        for<span class="list">(<span class="keyword">i</span> = c.length-1; i&gt;=0; i--)</span><span class="collection">&#123;</span><br><span class="line">           C = c<span class="collection">[i]</span>.split<span class="list">(<span class="keyword">'='</span>)</span><span class="comment">;</span></span><br><span class="line">           cookies<span class="collection">[C<span class="collection">[<span class="number">0</span>]</span>]</span> = C<span class="collection">[<span class="number">1</span>]</span><span class="comment">;</span></span><br><span class="line">        &#125;</span></span><br><span class="line"></span><br><span class="line">        return cookies<span class="collection">[name]</span><span class="comment">;</span></span><br><span class="line">    &#125;</span></span><br><span class="line"></span><br><span class="line">    //暴露接口</span><br><span class="line">    window.getCookie = getCookie</span><br><span class="line">&#125;</span>)<span class="list">()</span><span class="comment">;</span></span></span></span><br></pre></td></tr></table></figure>
<h4 id="Set_Cookie">Set Cookie</h4><p><strong>方法1: 稍微简单</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setCookie</span>(<span class="params">name, value, days</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (days) &#123;</span><br><span class="line">        <span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">        date.setTime(date.getTime() + (days * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>));</span><br><span class="line">        <span class="keyword">var</span> expires = <span class="string">"; expires="</span> + date.toGMTString();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">var</span> expires = <span class="string">""</span>;</span><br><span class="line">    <span class="built_in">document</span>.cookie = name + <span class="string">"="</span> + value + expires + <span class="string">"; path=/"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>方法2: 更加完善的，来自<a href="https://developer.mozilla.org/en-US/docs/Web/API/document.cookie" target="_blank" rel="external">MDN</a></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setCookie</span>(<span class="params">sKey, sValue, vEnd, sPath, sDomain, bSecure</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!sKey || <span class="regexp">/^(?:expires|max\-age|path|domain|secure)$/i</span>.test(sKey)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> sExpires = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">if</span> (vEnd) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (vEnd.constructor) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="built_in">Number</span>:</span><br><span class="line">                sExpires = vEnd === <span class="literal">Infinity</span> ? <span class="string">"; expires=Fri, 31 Dec 9999 23:59:59 GMT"</span> : <span class="string">"; max-age="</span> + vEnd;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="built_in">String</span>:</span><br><span class="line">                sExpires = <span class="string">"; expires="</span> + vEnd;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="built_in">Date</span>:</span><br><span class="line">                sExpires = <span class="string">"; expires="</span> + vEnd.toUTCString();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">document</span>.cookie = <span class="built_in">encodeURIComponent</span>(sKey) + <span class="string">"="</span> + <span class="built_in">encodeURIComponent</span>(sValue) + sExpires + (sDomain ? <span class="string">"; domain="</span> + sDomain : <span class="string">""</span>) + (sPath ? <span class="string">"; path="</span> + sPath : <span class="string">""</span>) + (bSecure ? <span class="string">"; secure"</span> : <span class="string">""</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>或者更加完善的操作可以参考 <code>jquery.cookie.js</code>的代码</p>
<h3 id="参考">参考</h3><ol>
<li>url定义：<a href="https://dvcs.w3.org/hg/url/raw-file/tip/Overview.html#urls" target="_blank" rel="external">https://dvcs.w3.org/hg/url/raw-file/tip/Overview.html#urls</a></li>
<li><a href="http://www.w3.org/TR/WD-html40-970708/htmlweb.html" target="_blank" rel="external">http://www.w3.org/TR/WD-html40-970708/htmlweb.html</a> </li>
<li><a href="http://www.quirksmode.org/js/cookies.html" target="_blank" rel="external">http://www.quirksmode.org/js/cookies.html</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/document.cookie" target="_blank" rel="external">https://developer.mozilla.org/en-US/docs/Web/API/document.cookie</a></li>
</ol>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2013/09/05/DOM-and-BOM/" itemprop="url">
                Dom 和 BOM
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2013-09-05T00:00:00+08:00" content="2013-09-05">
            2013-09-05
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/前端开发/" itemprop="url" rel="index">
                  <span itemprop="name">前端开发</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h3 id="BOM是什么？">BOM是什么？</h3><p>要在网页中使用javascript来访问浏览器，就必须通过BOM提供的对象。window有双重角色，访问浏览器的接口，又是ECMAScript定义的Global对象<br>其中window对象包含 location,navigator,screen,history</p>
<h3 id="DOM是什么？">DOM是什么？</h3><p>DOM是HTML和XML的API， 将页面和脚本（编程语言）连接在一起. 开发过程中用来操作页面的 event，methods，property，全都被封装在一个个的Object里面，DOM经常和javascript结合在一起，但是这是DOM是一个API，他是独立于编程语言之外的，DOM接口的实现可以基于任意语言.<br>DOM其中包含了CSSOM，说白了就是CSS Object Model， style Obejct暴露出Stylesheet和 CSSStyleSheet 的接口.通过 document.styleSheets 通过index可以获取到每一个CSSStyleSheet, 例如  <code>document.styleSheets[0]</code> 获取到的是页面第一个定义的stylesheet 更加详细参考CSS Reference：<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Reference?redirectlocale=en-US&amp;redirectslug=CSS%2FCSS_Reference" target="_blank" rel="external">https://developer.mozilla.org/en-US/docs/Web/CSS/Reference?redirectlocale=en-US&amp;redirectslug=CSS%2FCSS_Reference</a> </p>
<p>Dom Style Object 是每一个html元素上样式的Object，这个与document.styleSheets这个集合是不一样的<br>document.getElementById(‘d’).style.color = ‘orange’;</p>
<p>DOM另外一个重要的就是DOM Event，浏览器丰富的交互就是得益于事件的响应  参考DOM event reference</p>
<h3 id="参考：">参考：</h3><ul>
<li><a href="https://developer.mozilla.org/en-US/docs/DOM" target="_blank" rel="external">DOM的介绍</a></li>
<li><a href="http://www.w3.org/DOM/" target="_blank" rel="external">DOM的定义</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/DOM/DOM_Reference" target="_blank" rel="external">DOM API查询</a></li>
<li><a href="http://ejohn.org/blog/the-dom-is-a-mess/" target="_blank" rel="external">John Resig the dom is a mess</a></li>
</ul>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2013/08/27/LocalStorage-and-SessionStorage/" itemprop="url">
                localStorage 和 sessionStorage 的区别
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2013-08-27T00:00:00+08:00" content="2013-08-27">
            2013-08-27
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/前端开发/" itemprop="url" rel="index">
                  <span itemprop="name">前端开发</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h2 id="相同点">相同点</h2><p>两者都是web storage的定义，已key value的形式保存数据，安装草案，应该是可以存储有结构的数据，例如Object，原始类型，正则表达式等，但是现阶段只能存储字符串。如果要保存非字符串，就需要自己进行encode和decode了</p>
<h2 id="异同点">异同点</h2><p>两种的区别在与生存周期(lifetimes) 和 域(scope)的差别</p>
<h3 id="lifetimes">lifetimes</h3><p>localStorage: 永久，除非主动删除或者用户要求浏览器删除<br>sessionStorage: 浏览器窗口或者Tab关闭，就会清除</p>
<h3 id="scope">scope</h3><p>文档域定义： protocol, hostname, and port， localStorage和sessionStorage的域都是文档域，但是sessionStorage的域同时受到窗口或者Tab页的限制，也就是说，处于同一个文档域的不同浏览器Tab页（窗口）是持有不用sesstionStorage的</p>
<p>所以以下网站保存的localStorage都是独立的</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">http:</span><span class="comment">//www.example.com        // Protocol: http; hostname: www.example.com</span></span><br><span class="line"><span class="string">https:</span><span class="comment">//www.example.com       // Different protocol</span></span><br><span class="line"><span class="string">http:</span><span class="comment">//static.example.com     // Different hostname</span></span><br><span class="line"><span class="string">http:</span><span class="comment">//www.example.com:8000   // Different port</span></span><br></pre></td></tr></table></figure>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2013/08/12/Javascript-Callback-Soup/" itemprop="url">
                回调函数的优化
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2013-08-12T00:00:00+08:00" content="2013-08-12">
            2013-08-12
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/前端开发/" itemprop="url" rel="index">
                  <span itemprop="name">前端开发</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h3 id="什么是callback？">什么是callback？</h3><blockquote>
<p>Callbacks are functions that are executed asynchronously, or at a later time. Instead of the code reading top to bottom procedurally, async programs may execute different functions at different times based on the order and speed that earlier functions like http requests or file system reads happen.</p>
</blockquote>
<p>下面就是一段 多个callback嵌套的代码例子， 难读懂，可维护性差;</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function mainFunction() &#123;</span><br><span class="line">   getData(function(err, <span class="literal">result</span>) &#123;</span><br><span class="line">      getMoreData(<span class="literal">result</span>, function(err2, moreResults) &#123;</span><br><span class="line">          finallyGetLastData(&#123;first: <span class="literal">result</span>, second: moreResults&#125;, function(err3, finalResults) &#123;</span><br><span class="line">               //<span class="type">Do</span> something <span class="keyword">with</span> all the results here...</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="解决办法：">解决办法：</h3><h4 id="组织好函数,给函数命名">组织好函数,给函数命名</h4><p><strong>好处：</strong></p>
<ul>
<li>易读，易理解</li>
<li>发生异常的时候可以从 stack traces看到真正的函数名，而不是 “anonymous”匿名函数</li>
</ul>
<p>allows you to keep your code shallow, or not nested deeply, which brings me to my next point:</p>
<h5 id="修改前：">修改前：</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> form = <span class="built_in">document</span>.querySelector(<span class="string">'form'</span>)</span><br><span class="line">form.onsubmit = <span class="function"><span class="keyword">function</span>(<span class="params">submitEvent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name = <span class="built_in">document</span>.querySelector(<span class="string">'input'</span>).value</span><br><span class="line">  request(&#123;</span><br><span class="line">    uri: <span class="string">"http://example.com/upload"</span>,</span><br><span class="line">    body: name,</span><br><span class="line">    method: <span class="string">"POST"</span></span><br><span class="line">  &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, response, body</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> statusMessage = <span class="built_in">document</span>.querySelector(<span class="string">'.status'</span>)</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> statusMessage.value = err</span><br><span class="line">    statusMessage.value = body</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="修改后：">修改后：</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formSubmit</span>(<span class="params">submitEvent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name = <span class="built_in">document</span>.querySelector(<span class="string">'input'</span>).value</span><br><span class="line">  request(&#123;</span><br><span class="line">    uri: <span class="string">"http://example.com/upload"</span>,</span><br><span class="line">    body: name,</span><br><span class="line">    method: <span class="string">"POST"</span></span><br><span class="line">  &#125;, postResponse)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">postResponse</span>(<span class="params">err, response, body</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> statusMessage = <span class="built_in">document</span>.querySelector(<span class="string">'.status'</span>)</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> statusMessage.value = err</span><br><span class="line">  statusMessage.value = body</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">'form'</span>).onsubmit = formSubmit</span><br></pre></td></tr></table></figure>
<h4 id="(Partial_functions)http://en-wikipedia-org/wiki/Partial_function">(Partial functions)<a href="http://en.wikipedia.org/wiki/Partial_function" target="_blank" rel="external">http://en.wikipedia.org/wiki/Partial_function</a></h4><p><strong>partial函数的例子</strong>：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span><span class="params">(a, b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add5</span><span class="params">(b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> add.apply(<span class="literal">null</span>,[<span class="number">5</span>,b]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用这个例子来partial函数来简化过程</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">function getData(cb) &#123;</span><br><span class="line">    cb(null, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">function getMoreData(param, cb) &#123;</span><br><span class="line">    cb(null, param + <span class="number">1</span>); //<span class="type">We</span> don't really care about the <span class="string">"result"</span> variable</span><br><span class="line">&#125;</span><br><span class="line">function finallyGetLastData(opts, cb) &#123;</span><br><span class="line">    cb(null, <span class="number">400</span>); //<span class="type">We</span> don't care about <span class="string">"result"</span> <span class="keyword">or</span> <span class="string">"changedResults"</span>, the callback will already have them pre-<span class="type">set</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">function finallyGetLastDataCB(<span class="literal">result</span>, changedResults, err, finalResults) &#123;</span><br><span class="line">        <span class="keyword">var</span> diff = changedResults - <span class="literal">result</span>;</span><br><span class="line">        console.log(<span class="string">"Result: "</span> + <span class="literal">result</span> + <span class="string">" - Final Result: "</span> + finalResults);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">function getMoreDataCB(<span class="literal">result</span>, err, moreResults) &#123;</span><br><span class="line">   <span class="keyword">var</span> changedResults = <span class="literal">result</span> * <span class="number">2</span>;</span><br><span class="line">   finallyGetLastData(&#123;</span><br><span class="line">            first : <span class="literal">result</span>,</span><br><span class="line">            second : moreResults</span><br><span class="line">    &#125;, partial(finallyGetLastDataCB, [<span class="literal">result</span>, changedResults]));</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">function mainFunction() &#123;</span><br><span class="line">    getData(function(err, <span class="literal">result</span>)&#123;</span><br><span class="line">        getMoreData(<span class="literal">result</span>, partial(getMoreDataCB, [<span class="literal">result</span>]));</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;</span><br><span class="line">function partial(func, args) &#123;</span><br><span class="line">    <span class="keyword">return</span> function()&#123; </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> arguments) &#123;</span><br><span class="line">            args.push(arguments[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> func.apply(this, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="参考：">参考：</h3><ol>
<li>介绍callback <a href="https://github.com/maxogden/art-of-node#callbacks" target="_blank" rel="external">https://github.com/maxogden/art-of-node#callbacks</a> </li>
<li>如何让callback不那么恐怖：<a href="http://callbackhell.com/" target="_blank" rel="external">http://callbackhell.com/</a></li>
</ol>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2013/03/04/避免浏览器直接打开文件-Content-disposition/" itemprop="url">
                避免浏览器直接打开文件-Content-disposition
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2013-03-04T00:00:00+08:00" content="2013-03-04">
            2013-03-04
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/前端开发/" itemprop="url" rel="index">
                  <span itemprop="name">前端开发</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h3 id="解决办法:">解决办法:</h3><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">设置：Content-disposition = attachment;<span class="keyword">file</span>=<span class="keyword">filename</span></span><br></pre></td></tr></table></figure>
<p><strong>效果</strong>：以某文件名(filename)在浏览器上弹出“文件下载”对话框</p>
<p>这里<code>content-type:application/octet-stream</code>,或者不设置，因为Application默认是<code>application/octet-stream</code>, 而Multipart默认情况下被看作multipart/mixed。</p>
<p>——————解决了问题，然后下一步就是深究一下这个问题了———————–</p>
<p>多用途互联网邮件扩展（MIME，Multipurpose Internet Mail Extensions）是一个互联网标准，它扩展了电子邮件标准，使其能够支持非ASCII字符、二进制格式附件等多种格式的邮件消息。<br>MIME规定了用于表示各种各样的数据类型的符号化方法。 此外，在万维网中使用的HTTP协议中也使用了MIME的框架。</p>
<p>MIME的具体可以查询：<br><a href="http://mimeapplication.net/" target="_blank" rel="external">http://mimeapplication.net/</a></p>
<p>内容类型（Content-Type），这个头部领域用于指定消息的类型。一般以下面的形式出现:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="rule"><span class="attribute">Content-Type</span>:<span class="value"> [type]/[subtype]</span></span>; <span class="tag">parameter</span></span><br></pre></td></tr></table></figure>
<p><strong>type类型列表</strong></p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>：用于标准化地表示的文本信息，文本消息可以是多种字符集和或者多种格式的；</span><br><span class="line"><span class="type">Multipart</span>：用于连接消息体的多个部分构成一个消息，这些部分可以是不同类型的数据；</span><br><span class="line"><span class="type">Application</span>：用于传输应用程序数据或者二进制数据；</span><br><span class="line"><span class="type">Message</span>：用于包装一个<span class="type">E</span>-mail消息；</span><br><span class="line"><span class="type">Image</span>：用于传输静态图片数据；</span><br><span class="line"><span class="type">Audio</span>：用于传输音频或者音声数据；</span><br><span class="line"><span class="type">Video</span>：用于传输动态影像数据，可以是与音频编辑在一起的视频数据格式。</span><br><span class="line"><span class="title">subtype</span>用于指定<span class="typedef"><span class="keyword">type</span>的详细形式。content-<span class="keyword">type</span>/subtype配对的集合和与此相关的参数，将随着时间而增长。为了确保这些值在一个有序而且公开的状态下开发，<span class="type">MIME</span>使用<span class="type">Internet</span> <span class="type">Assigned</span> <span class="type">Numbers</span> <span class="type">Authority</span> <span class="container">(<span class="type">IANA</span>)</span>作为中心的注册机制来管理这些值。常用的subtype值如下所示：</span></span><br></pre></td></tr></table></figure>
<p><strong>subtype类型列表</strong></p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">text</span>/plain（纯文本）</span><br><span class="line"><span class="type">text</span>/html（HTML文档）</span><br><span class="line"><span class="type">application</span>/xhtml+xml（XHTML文档）</span><br><span class="line">image/gif（GIF图像）</span><br><span class="line">image/jpeg（JPEG图像）【PHP中为：image/pjpeg】</span><br><span class="line">image/png（PNG图像）【PHP中为：image/x-png】</span><br><span class="line">video/mpeg（MPEG动画）</span><br><span class="line"><span class="type">application</span>/octet-stream（任意的二进制数据）</span><br><span class="line"><span class="type">application</span>/pdf（PDF文档）</span><br><span class="line"><span class="type">application</span>/msword（Microsoft Word文件）</span><br><span class="line"><span class="type">application</span>/vnd.wap.xhtml+xml (wap1<span class="number">.0</span>+)</span><br><span class="line"><span class="type">application</span>/xhtml+xml (wap2<span class="number">.0</span>+)</span><br><span class="line">message/rfc822（RFC <span class="number">822</span>形式）</span><br><span class="line">multipart/alternative（HTML邮件的HTML形式和纯文本形式，相同内容使用不同形式表示）</span><br><span class="line"><span class="type">application</span>/x-www-form-urlencoded（使用HTTP的POST方法提交的表单）</span><br><span class="line">multipart/form-data（同上，但主要用于表单提交时伴随文件上传的场合）</span><br></pre></td></tr></table></figure>
<p>此外，尚未被接受为正式数据类型的subtype，可以使用x-开始的独立名称（例如<code>pplication/x-gzip</code>）。vnd-开始的固有名称也可以使用（例：application/vnd.ms-excel）。</p>
<p><code>parameter</code>可以用来指定附加的信息，更多情况下是用于指定text/plain和text/htm等的文字编码方式的charset参数。MIME根据type制定了默认的subtype，当客户端不能确定消息的subtype的情况下，消息被看作默认的subtype进行处理。Text默认是<code>text/plain</code>，Application默认是<code>application/octet-stream</code>, 而Multipart默认情况下被看作<code>multipart/mixed</code></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/">&laquo;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span>
  </nav>

 </div>

        

        
      </div>

      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      <section class="site-overview">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/default_avatar.jpg" alt="Andrew Zhang" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Andrew Zhang</p>
        </div>
        <p class="site-description motion-element" itemprop="description"></p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">40</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">19</span>
              <span class="site-state-item-name">分类</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">40</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner"> <div class="copyright" >
  
  &copy; &nbsp; 
  <span itemprop="copyrightYear">2015</span>
  <span class="with-love">
    <i class="icon-next-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Andrew Zhang</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>


 </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    
    

  


  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.1"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.1"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.5.1" id="motion.global"></script>




  <script type="text/javascript" src="/js/nav-toggle.js?v=0.4.5.1"></script>
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  

  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
      if (isMobile()) {
        FastClick.attach(document.body);
      }
    });
  </script>

  

  
  

  
  <script type="text/javascript" src="/js/lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/images/loading.gif",
        effect: "fadeIn"
      });
    });
  </script>
</body>
</html>
